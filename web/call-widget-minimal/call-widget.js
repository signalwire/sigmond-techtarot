(function(N,U){typeof exports=="object"&&typeof module<"u"?U(exports,require("@signalwire/js")):typeof define=="function"&&define.amd?define(["exports","@signalwire/js"],U):(N=typeof globalThis<"u"?globalThis:N||self,U(N.C2CWidget={},N.SignalWire))})(this,function(N,U){"use strict";var ot=Object.defineProperty;var ct=(N,U,F)=>U in N?ot(N,U,{enumerable:!0,configurable:!0,writable:!0,value:F}):N[U]=F;var C=(N,U,F)=>ct(N,typeof U!="symbol"?U+"":U,F);function F(j,...d){const i=j.reduce((r,f,h)=>r+f+(d[h]||""),"");return function(){const f=new DOMParser().parseFromString(i,"text/html");if(!f.body.firstChild)throw new Error("Invalid HTML template");const h={};f.body.querySelectorAll("[name]").forEach(_=>{const g=_.getAttribute("name");g&&(h[g]=_,_.removeAttribute("name"))});const v=document.createDocumentFragment();for(;f.body.firstChild;)v.appendChild(f.body.firstChild);return h}}const X=class X{constructor(){C(this,"styles",new Map)}static getInstance(){return X.instance||(X.instance=new X),X.instance}register(d){const i=d.length,r=i>40?`${i}:${d.slice(0,20)}:${d.slice(-20)}`:`${i}:${d}`;this.styles.has(r)||this.styles.set(r,d)}apply(d){const i=document.createElement("style");i.textContent=Array.from(this.styles.values()).join(`
`),d.appendChild(i)}};C(X,"instance");let te=X;const Y=te.getInstance();Y.register('.modal-container{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000000ed;display:flex;align-items:center;justify-content:center;animation:fadeIn .3s ease-out forwards;z-index:1000}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}@keyframes fadeOut{0%{opacity:1}to{opacity:0}}@keyframes springIn{0%{transform:scale(.4);opacity:0}60%{transform:scale(1.08);opacity:1}80%{transform:scale(.98)}to{transform:scale(1);opacity:1}}@keyframes springOut{0%{transform:scale(1);opacity:1}40%{transform:scale(1.08);opacity:1}to{transform:scale(.4);opacity:0}}.modal{position:relative;border-radius:8px;width:90%;max-width:1700px;max-height:90vh;overflow:hidden;animation:springIn .8s cubic-bezier(.22,1.2,.36,1) forwards}.modal.video-mode{grid-template-columns:1fr 0}.modal.video-mode .local-video-content{right:10px!important}.modal.video-mode .video-panel{width:100%}.modal.video-mode .video-controls{background:#000;width:100%}.modal.video-mode .chat-panel{width:0;display:none;width:100%}.modal.audio-transcript-mode{max-width:600px;grid-template-columns:1fr}.modal.audio-transcript-mode .loading{position:fixed!important}.modal.audio-transcript-mode .video-panel{width:100%;padding-bottom:0}.modal.audio-transcript-mode .video-area,.modal.audio-transcript-mode .local-video-content{display:none}.modal.audio-transcript-mode .video-controls{width:100%;position:static}.modal.audio-transcript-mode .chat-panel{width:100%;position:static;min-height:90vh;height:100%}@media (min-width: 2000px) and (max-height: 700px){.modal{max-width:900px}}@media (min-width: 1000px) and (max-height: 400px){.modal{max-width:700px}}.modal-container.closing{animation:fadeOut .3s ease-out forwards}.modal.closing{animation:springOut .8s cubic-bezier(.22,1.2,.36,1) forwards}.video-panel{position:relative;width:calc(100% - 300px);display:flex;flex-direction:column;align-items:center;overflow:hidden;justify-content:center}@media (min-width: 801px){.video-panel{padding-bottom:50px}}.audio-transcript-mode .video-panel{overflow:visible}.video-panel-background{content:"";position:absolute;top:0;right:0;bottom:0;left:0;z-index:-100;background-color:#000;background-size:cover;background-position:center;transform:scale(1.1);filter:blur(10px);transition:transform .2s linear,filter .2s linear}.video-panel-background.loaded{transform:scale(1);filter:blur(0)}.video-area{position:relative;width:100%;padding-top:56.25%}.local-video-content{position:absolute;bottom:60px;right:10px;width:min(230px,22%);max-height:40%;overflow:hidden;z-index:10;transform:translateZ(0);-webkit-transform:translateZ(0);cursor:pointer;transition:transform .3s ease}@media (min-width: 801px){.local-video-content{position:fixed;bottom:60px;right:310px}}@media (max-width: 600px){.local-video-content{width:40%}}.local-video-content:hover{cursor:alias;transform:translateZ(0) scale(1.02)}.local-video-content video{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain;transform:translateZ(0) scaleX(-1);-webkit-transform:translateZ(0) scaleX(-1);transition:transform .5s cubic-bezier(.4,0,.2,1);border-radius:8px}.local-video-content.flipped video{transform:translateZ(0) scaleX(1);-webkit-transform:translateZ(0) scaleX(1)}.video-content{position:absolute;top:0;left:0;width:100%;height:100%}.video-controls{height:50px;width:100%;position:relative}@media (min-width: 801px){.video-controls{position:fixed;bottom:0;width:calc(100% - 300px);left:0}}.chat-panel{position:absolute;top:0;right:0;bottom:0;width:300px;background:#f5f5f5;overflow-y:auto}@media (max-width: 800px){.modal{margin:20px;max-height:none;max-width:none;display:grid;grid-template-columns:1fr 300px;overflow:hidden}.video-panel{width:100%}.chat-panel{position:static;width:auto}}@media (max-width: 800px) and (orientation: portrait){.modal{width:calc(100% - 40px);height:calc(100% - 40px);grid-template-columns:1fr;grid-template-rows:auto 1fr}}@media (max-width: 800px) and (orientation: landscape){.modal{grid-template-columns:1fr 250px}}@media (max-width: 800px) and (max-height: 400px){.modal{width:calc(100vw - 40px);height:calc(100vh - 40px);margin:20px;max-width:none;max-height:none}.controls{position:fixed;bottom:0;left:0;width:calc(100% - 250px)}}.chat-panel{background:linear-gradient(135deg,#022677,#9c063a);height:100%}.chat{display:flex;flex-direction:column;padding:15px;font-family:Inter,sans-serif;font-size:15px}.audio-transcript-mode .chat-panel{height:80vh!important}.audio-transcript-mode .chat{margin-bottom:70px}.message{margin-bottom:5px;padding:8px 12px;border-radius:10px;max-width:80%;color:#fff;position:relative;min-width:60%;min-height:15px;line-height:1.3}.message p{margin:0}.message p a{color:#fff;text-decoration:underline}.message p a:hover{text-decoration-thickness:2px}.message p a:visited{color:#fff}.message>.tail{position:absolute;bottom:2px;right:0;width:10px;height:10px;display:none;transform:scale(.6)}.message>.tail svg{fill:#044ef4}.message-received>.tail{transform:scaleX(-1) scale(.5);left:0}.message-received>.tail svg{fill:#f72a72}.message-received{background:#f72a72;align-self:flex-start}.message-sent{background:#044ef4;align-self:flex-end}.message-received+.message-sent,.message-sent+.message-received{margin-top:15px}.message-sent:has(+.message-received),.message-sent:last-child{border-bottom-right-radius:2px}.message-sent:has(+.message-received) .tail,.message-sent:last-child .tail{display:block}.message-received:has(+.message-sent),.message-received:last-child{border-bottom-left-radius:2px}.message-received:has(+.message-sent) .tail,.message-received:last-child .tail{display:block}@keyframes heartbeat{0%{opacity:.8;transform:scale(1)}50%{opacity:1;transform:scale(1.01)}to{opacity:.8;transform:scale(1)}}.message.in-progress{animation:heartbeat 1.5s ease-in-out infinite}.controls{display:flex;gap:8px;background:#0009;height:50px;justify-content:center;align-items:center}.control-group{display:flex;align-items:center}.control-button{width:40px;height:40px;border-radius:50%;border:none;background:#ffffff1a;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background-color .2s}.control-group .control-button{border-radius:20px 0 0 20px;margin-right:1px}.standalone{border-radius:50%!important;margin-right:0}.device-select-button{height:40px;border-radius:0 20px 20px 0;border:none;background:#ffffff1a;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background-color .2s}.control-button:hover,.device-select-button:hover{background:#fff3}.control-button svg{width:24px;height:24px;color:#fff}.device-select-button svg{width:12px;height:12px;color:#fff}.hangup{border-radius:50%!important;background:#f44}.hangup:hover{background:#f66}.device-menu{position:absolute;bottom:100%;left:50%;transform:translate(-50%);margin-bottom:8px;background:#000000e6;border-radius:8px;padding:8px;min-width:200px;z-index:1000}.device-option{font-size:15px;font-family:sans-serif;color:#fff;padding:6px 4px;cursor:pointer;border-radius:4px;display:flex;align-items:center;gap:8px}.device-option.selected{font-weight:700}.device-option:hover{background:#ffffff1a}.device-option svg{width:16px;height:16px;color:#007bff;flex-shrink:0}.muted-icon,.unmuted-icon{display:flex;align-items:center;justify-content:center}#menuContainer,.device-select-wrapper{position:relative}.device-select-button:disabled{opacity:.5;cursor:not-allowed;pointer-events:none}.audio-transcript-mode .video-button,.audio-transcript-mode .video-devices-button{display:none!important}.audio-transcript-mode .device-menu{bottom:auto;top:100%;margin-bottom:0;margin-top:8px}.loading{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.loading-icon{color:#fff}.loading-icon svg{animation:spin 3s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error-message{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1000;background:#fff;padding:0;border-radius:12px;box-shadow:0 8px 24px #0003;max-width:90%;min-width:400px;font-family:Inter,sans-serif;display:flex;flex-direction:column}@media (max-width: 768px){.error-message{transform:translate(-50%,calc(-50% - 50px));min-width:unset;width:88%;max-width:88%}}.error-message .error-header{display:flex;justify-content:flex-start;align-items:center;padding:16px 24px;border-bottom:1px solid #eee}.error-message .error-header .error-title{margin:0;font-size:18px;font-weight:600;color:#111}.error-message .error-content{padding:24px;display:flex;flex-direction:column;gap:24px}.error-message .error-content .error-text{font-size:15px;color:#333;line-height:1.5;text-align:left}.error-message .error-content .action-button{align-self:flex-end;padding:10px 24px;border:none;border-radius:6px;background:#044ef4;color:#fff;font-family:Inter,sans-serif;font-size:14px;font-weight:500;cursor:pointer;transition:background-color .2s ease,transform .1s ease}.error-message .error-content .action-button:hover{background:#0446db}.error-message .error-content .action-button:active{transform:scale(.98);background:#033ec2}.modal-container:has(.error) .modal{filter:blur(4px)}.survey-message{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1000;background:#fff;padding:0;border-radius:12px;box-shadow:0 8px 24px #0003;max-width:90%;min-width:400px;font-family:Inter,sans-serif;display:flex;flex-direction:column}@media (max-width: 768px){.survey-message{transform:translate(-50%,calc(-50% - 50px));min-width:unset;width:88%;max-width:88%}}.survey-message .survey-header{display:flex;justify-content:flex-start;align-items:center;padding:16px 24px;border-bottom:1px solid #eee}.survey-message .survey-header .survey-title{margin:0;font-size:18px;font-weight:600;color:#111}.survey-message .survey-content{padding:24px;display:flex;flex-direction:column;gap:24px}.survey-message .survey-content .survey-text{font-size:15px;color:#333;line-height:1.5;text-align:left}.survey-message .survey-content .survey-actions{display:flex;justify-content:flex-end;gap:12px}.survey-message .survey-content .action-button{padding:10px 24px;border-radius:4px;font-family:Inter,sans-serif;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s;text-decoration:none;display:flex;align-items:center;gap:8px}.survey-message .survey-content .action-button.outlined{background:transparent;border:2px solid #044ef4;color:#044ef4}.survey-message .survey-content .action-button.outlined:hover{background:#044ef41a}.survey-message .survey-content .action-button.primary{background:#044ef4;color:#fff;border:none}.survey-message .survey-content .action-button.primary:hover{background:#033ec2}.survey-message .survey-content .action-button.primary svg{width:16px;height:16px}.modal-container:has(.survey-message) .modal{filter:blur(4px)}.user-form-container{position:absolute;top:calc(50% + 25px);left:50%;transform:translate(-50%,-50%);background:#fffffff2;padding:25px;border-radius:8px;box-shadow:0 2px 10px #0000001a;z-index:1000;font-family:Inter,sans-serif;width:min(400px,90%);opacity:1;transition:opacity .3s ease-out}@media (max-width: 800px),(max-height: 600px){.user-form-container{position:absolute;top:0;left:0;width:calc(100% - 50px);height:100%;transform:none;border-radius:0;display:flex;align-items:center;justify-content:center}}.user-form-container.fade-out{opacity:0}.user-form-container .close-button{position:absolute;top:0;right:1px;background:transparent;border:none;cursor:pointer;padding:4px;color:#666;transition:color .2s}.user-form-container .close-button:hover{color:#333}.user-form-container .close-button svg{width:24px;height:24px}.user-form{margin-top:10px;display:flex;flex-direction:column;gap:1rem;width:100%}.user-form input{width:100%;padding:.75rem;border:1px solid #ddd;border-radius:4px;font-size:1rem;font-family:inherit;box-sizing:border-box;background-color:#fff;color:#333}@media (max-width: 480px){.user-form input{padding:.6rem;font-size:.95rem}}.form-helper-text{color:#666;margin-bottom:16px;text-align:center}.form-buttons{display:flex;gap:12px;justify-content:center;margin-top:.5rem}.form-buttons button{padding:.75rem 1.5rem;border-radius:4px;font-size:1rem;cursor:pointer;transition:all .2s;font-family:inherit}@media (max-width: 480px){.form-buttons button{padding:.6rem 1.2rem;font-size:.95rem}}.skip-button{background:transparent;border:2px solid #044ef4;color:#044ef4}.skip-button:hover{background:#044ef41a}.submit-button{background:#044ef4;color:#fff;border:none}.submit-button:hover{background:#033ec2}');const Ve=F`
  <div class="modal-container" name="modalContainer">
    <div class="modal" name="modal">
      <div class="video-panel" name="videoPanel">
        <div class="video-panel-background" name="videoPanelBackground"></div>
        <div class="local-video-content" name="localVideoArea">
          <!-- Local Video area -->
        </div>
        <div class="video-area">
          <div class="video-content" name="videoArea">
            <!-- Remote Video area -->
          </div>
        </div>
        <div class="video-controls" name="controlsPanel">
          <!-- Controls panel -->
        </div>
      </div>
      <div class="chat-panel" name="chatPanel"></div>
    </div>
  </div>
`;function re(j){const{modalContainer:d,videoPanel:i,videoArea:r,localVideoArea:f,controlsPanel:h,chatPanel:v,videoPanelBackground:_}=Ve();f.addEventListener("click",()=>{f.classList.toggle("flipped")});const g=F`<img
    name="image"
    src="${j==null?void 0:j.backgroundImage}"
  />`,{image:E}=g(),S=()=>{_.classList.add("loaded"),_.style.backgroundImage=`url(${E.src})`};return _.style.backgroundImage=`url(${j==null?void 0:j.backgroundThumbnail})`,"decode"in E?E.decode().then(S).catch(()=>{S()}):E.onload=S,{modalContainer:d,videoPanel:i,videoArea:r,localVideoArea:f,controlsPanel:h,chatPanel:v}}const me=F`
  <div class="loading" name="loading">
    <div class="loading-icon">${`<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 256 256" height="50px" width="50px" xmlns="http://www.w3.org/2000/svg">
  <path d="M140,32V64a12,12,0,0,1-24,0V32a12,12,0,0,1,24,0Zm33.25,62.75a12,12,0,0,0,8.49-3.52L204.37,68.6a12,12,0,0,0-17-17L164.77,74.26a12,12,0,0,0,8.48,20.49ZM224,116H192a12,12,0,0,0,0,24h32a12,12,0,0,0,0-24Zm-42.26,48.77a12,12,0,1,0-17,17l22.63,22.63a12,12,0,0,0,17-17ZM128,180a12,12,0,0,0-12,12v32a12,12,0,0,0,24,0V192A12,12,0,0,0,128,180ZM74.26,164.77,51.63,187.4a12,12,0,0,0,17,17l22.63-22.63a12,12,0,1,0-17-17ZM76,128a12,12,0,0,0-12-12H32a12,12,0,0,0,0,24H64A12,12,0,0,0,76,128ZM68.6,51.63a12,12,0,1,0-17,17L74.26,91.23a12,12,0,0,0,17-17Z"></path>
</svg>`}</div>
  </div>
`;let Ie=class{constructor(){C(this,"entries",[]);C(this,"lastSpoken",null)}},Re=class{constructor(){C(this,"state");C(this,"aiPartialResult",null);C(this,"userPartialResult",null);this.state=new Ie}getHistory(){const d=[...this.state.entries];return this.aiPartialResult&&this.userPartialResult?this.state.lastSpoken==="user"?(d.push(this.aiPartialResult),d.push(this.userPartialResult)):(d.push(this.userPartialResult),d.push(this.aiPartialResult)):this.aiPartialResult?d.push(this.aiPartialResult):this.userPartialResult&&d.push(this.userPartialResult),d}handleEvent(d,i,r){switch(d){case"ai.response_utterance":this.aiPartialResult?this.aiPartialResult.text+=" "+i:this.aiPartialResult={type:"ai",text:i,state:"partial"},this.state.lastSpoken="ai";break;case"ai.completion":this.aiPartialResult&&(this.state.entries.push({...this.aiPartialResult,state:"complete"}),this.aiPartialResult=null),this.state.lastSpoken=r?"user":"ai";break;case"ai.partial_result":this.userPartialResult={type:"user",text:i,state:"partial"},this.state.lastSpoken="user";break;case"ai.speech_detect":this.userPartialResult&&(this.state.entries.push({...this.userPartialResult,state:"complete",text:i}),this.userPartialResult=null),this.state.lastSpoken="user";break}this.onUpdate()}onUpdate(){}};class ge{constructor(){C(this,"devices",[]);C(this,"loading",!1);C(this,"selectedMicrophone",null);C(this,"selectedCamera",null);C(this,"selectedSpeaker",null);C(this,"isAudioMuted",!1);C(this,"isVideoMuted",!1);C(this,"isSpeakerMuted",!1);C(this,"currentVideoAspectRatio",null)}get audioinput(){return this.devices.filter(d=>d.kind==="audioinput")}get audiooutput(){return this.devices.filter(d=>d.kind==="audiooutput")}get videoinput(){return this.devices.filter(d=>d.kind==="videoinput")}}const Q=class Q{constructor(){C(this,"state",new ge);C(this,"call",null);C(this,"deviceWatcher",null);C(this,"permissionStream",null)}static getInstance(){return Q.instance||(Q.instance=new Q),Q.instance}async getPermissions(d=!0){try{const i=await U.WebRTC.getUserMedia({audio:!0,video:d});return this.permissionStream&&this.permissionStream.getTracks().forEach(r=>r.stop()),this.permissionStream=i,{success:!0}}catch(i){return console.error("Error getting permissions:",i),{success:!1,message:i instanceof Error?i.message:"Failed to get device permissions"}}}async setup(d){this.permissionStream&&(this.permissionStream.getTracks().forEach(i=>i.stop()),this.permissionStream=null),this.state.loading=!0,this.call=d;try{await this._updateDevicesList(),await this._updateSelectedDevices(),this.updateVideoAspectRatio(),this.deviceWatcher=await U.WebRTC.createDeviceWatcher(),this.deviceWatcher.on("changed",async()=>{await this._updateDevicesList(),await this._updateSelectedDevices(),this.updateVideoAspectRatio(),this.onChange()}),this.state.loading=!1,this.onLoad()}catch(i){console.error("Error in setup:",i),this.state.loading=!1}}async _updateDevicesList(){var i,r,f,h;const d=await U.WebRTC.enumerateDevices();if(this.state.devices=d,this.call){if(this.state.isVideoMuted){const v=this.call.localVideoTrack||((r=(i=this.call.localStream)==null?void 0:i.getVideoTracks())==null?void 0:r[0]);v&&(v.enabled=!1)}if(this.state.isAudioMuted){const v=this.call.localAudioTrack||((h=(f=this.call.localStream)==null?void 0:f.getAudioTracks())==null?void 0:h[0]);v&&(v.enabled=!1)}}}async _updateSelectedDevices(){const{audioinput:d,audiooutput:i,videoinput:r}=this.state;!this.state.selectedMicrophone&&d.length>0&&(this.state.selectedMicrophone=d[0]),!this.state.selectedCamera&&r.length>0&&(this.state.selectedCamera=r[0]),!this.state.selectedSpeaker&&i.length>0&&(this.state.selectedSpeaker=i[0]),this.state.selectedMicrophone=d.find(f=>{var h;return f.deviceId===((h=this.state.selectedMicrophone)==null?void 0:h.deviceId)})||d[0]||null,this.state.selectedCamera=r.find(f=>{var h;return f.deviceId===((h=this.state.selectedCamera)==null?void 0:h.deviceId)})||r[0]||null,this.state.selectedSpeaker=i.find(f=>{var h;return f.deviceId===((h=this.state.selectedSpeaker)==null?void 0:h.deviceId)})||i[0]||null}updateVideoAspectRatio(){var f;if(!((f=this.call)!=null&&f.localStream))return;const d=this.call.localStream.getVideoTracks()[0];if(!d)return;const i=d.getSettings(),r=i.aspectRatio||(i.width&&i.height?i.width/i.height:null);r!==this.state.currentVideoAspectRatio&&(this.state.currentVideoAspectRatio=r,this.onAspectRatioChange(r||null))}onLoad(){}onChange(){}onAspectRatioChange(d){console.log("onAspectRatioChange",d)}async updateCamera(d){const i=this.state.devices.find(r=>r.deviceId===d&&r.kind==="videoinput");if(!i||!this.call)return!1;try{return await this.call.updateCamera({deviceId:d}),this.state.selectedCamera=i,this.updateVideoAspectRatio(),this.onChange(),!0}catch(r){return console.error("Error updating camera:",r),!1}}async updateMicrophone(d){const i=this.state.devices.find(r=>r.deviceId===d&&r.kind==="audioinput");if(!i||!this.call)return!1;try{return await this.call.updateMicrophone({deviceId:d}),this.state.selectedMicrophone=i,this.onChange(),!0}catch(r){return console.error("Error updating microphone:",r),!1}}async updateSpeaker(d){const i=this.state.devices.find(r=>r.deviceId===d&&r.kind==="audiooutput");if(!i||!this.call)return!1;try{return await this.call.updateSpeaker({deviceId:d}),this.state.selectedSpeaker=i,this.onChange(),!0}catch(r){return console.error("Error updating speaker:",r),!1}}async toggleVideo(){var d;if(this.call)try{const i=await this.getSelf();i!=null&&i.videoMuted?await this.call.videoUnmute():await this.call.videoMute(),this.state.isVideoMuted=!this.state.isVideoMuted,this.onChange()}catch(i){console.error("Failed to toggle video via call method, trying fallback:",i);try{const r=this.call.localVideoTrack;if(r){r.enabled=this.state.isVideoMuted,this.state.isVideoMuted=!this.state.isVideoMuted,this.onChange();return}const f=this.call.localStream,h=(d=f==null?void 0:f.getVideoTracks())==null?void 0:d[0];if(h){h.enabled=this.state.isVideoMuted,this.state.isVideoMuted=!this.state.isVideoMuted,this.onChange();return}console.error("No video track available for fallback muting")}catch(r){console.error("Failed to toggle video via fallback method:",r)}}}async toggleAudio(){var d;if(this.call)try{const i=await this.getSelf();i!=null&&i.audioMuted?await this.call.audioUnmute():await this.call.audioMute(),this.state.isAudioMuted=!this.state.isAudioMuted,this.onChange()}catch(i){console.error("Failed to toggle audio via call method, trying fallback:",i);try{const r=this.call.localAudioTrack;if(r){r.enabled=this.state.isAudioMuted,this.state.isAudioMuted=!this.state.isAudioMuted,this.onChange();return}const f=this.call.localStream,h=(d=f==null?void 0:f.getAudioTracks())==null?void 0:d[0];if(h){h.enabled=this.state.isAudioMuted,this.state.isAudioMuted=!this.state.isAudioMuted,this.onChange();return}console.error("No audio track available for fallback muting")}catch(r){console.error("Failed to toggle audio via fallback method:",r)}}}async toggleSpeaker(){if(this.call)try{const d=await this.getSelf();d!=null&&d.deaf?await this.call.undeaf():await this.call.deaf(),this.state.isSpeakerMuted=!this.state.isSpeakerMuted,this.onChange()}catch(d){console.error("Failed to toggle speaker via deaf/undeaf, trying fallback:",d);try{this.call.audioEl&&(this.call.audioEl.muted=!this.state.isSpeakerMuted,this.state.isSpeakerMuted=!this.state.isSpeakerMuted,this.onChange())}catch(i){console.error("Failed to toggle speaker via fallback method:",i)}}}async getSelf(){if(!this.call)return null;const d=await this.call.getMembers();return d==null?void 0:d.members.find(i=>{var r;return i.id===((r=this.call)==null?void 0:r.memberId)})}reset(){var d,i,r;this.deviceWatcher&&(this.deviceWatcher.off("changed"),this.deviceWatcher=null),this.permissionStream&&(this.permissionStream.getTracks().forEach(f=>f.stop()),this.permissionStream=null),(d=this.call)!=null&&d.localStream&&this.call.localStream.getTracks().forEach(h=>{h.stop()}),(i=this.call)!=null&&i.localVideoTrack&&this.call.localVideoTrack.stop(),(r=this.call)!=null&&r.localAudioTrack&&this.call.localAudioTrack.stop(),this.call=null,this.state=new ge,this.onLoad=()=>{},this.onChange=()=>{},this.onAspectRatioChange=()=>{}}};C(Q,"instance");let ae=Q;const O=ae.getInstance();let Be=class{constructor({callDetails:d,token:i,widget:r}){C(this,"client",null);C(this,"callDetails",null);C(this,"widget");C(this,"chat",null);C(this,"currentCall",null);C(this,"token",null);C(this,"userVariables",null);this.callDetails=d??null,this.token=i??null,this.widget=r}async getWidgetToken(d){const i=await fetch("https://embeds.signalwire.com/api/fabric/embeds/tokens",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:d})});if(!i.ok)throw new Error("Failed to authenticate embeds token");return(await i.json()).token}getLocalVideoTrack(){var d;return(d=this.currentCall)==null?void 0:d.localVideoTrack}getLocalAudioTrack(){var d;return(d=this.currentCall)==null?void 0:d.localAudioTrack}async setupClient(){if(!this.token)throw new Error("Token is not set");let d=this.token;this.token.startsWith("c2c_")&&(d=await this.getWidgetToken(this.token));const i=await U.SignalWire({token:d});return i.on("ai.partial_result",r=>{var f;(f=this.chat)==null||f.handleEvent("ai.partial_result",r.text??"",r.barged??!1)}),i.on("ai.speech_detect",r=>{var h;const f=r.text.replace(/\{confidence=[\d.]+\}/,"");(h=this.chat)==null||h.handleEvent("ai.speech_detect",f,r.type!=="normal")}),i.on("ai.completion",r=>{var f;(f=this.chat)==null||f.handleEvent("ai.completion",r.text??"",r.type==="barged")}),i.on("ai.response_utterance",r=>{var f;(f=this.chat)==null||f.handleEvent("ai.response_utterance",r.utterance??"",!1)}),this.client=i,i}addUserVariables(d){this.userVariables={...this.userVariables,...d}}async dial(d,i,r){["ci-SAT","pt-SAT","as-SAT"].forEach(_=>sessionStorage.removeItem(_));const f=await this.setupClient();if(this.chat=new Re,!this.callDetails)throw new Error("Call details are not set");const h={callOriginHref:window.location.href,...this.userVariables},v=await f.dial({to:this.callDetails.destination,rootElement:d,audio:this.callDetails.supportsAudio,video:this.callDetails.supportsVideo,negotiateVideo:this.callDetails.supportsVideo,userVariables:h});return this.currentCall=v,console.info("Call started",this.currentCall,"with user variables",h),v.on("call.joined",()=>{const _=new CustomEvent("call.joined",{detail:{call:this.currentCall,client:this.client},bubbles:!0});if(this.widget.dispatchEvent(_),window.call=v,v!=null&&v.localStream){O.updateVideoAspectRatio();const{localVideo:g}=F`<video
          autoplay
          playsinline
          muted
          name="localVideo"
        ></video>`();g.onloadedmetadata=()=>{O.onAspectRatioChange(g.videoWidth/g.videoHeight)},g.srcObject=v.localStream,r(g)}}),this.chat&&(this.chat.onUpdate=()=>{var _;i(((_=this.chat)==null?void 0:_.getHistory())??[])}),v}async start(){var d;if(!this.client)throw new Error("Client is not set");await((d=this.currentCall)==null?void 0:d.start())}async hangup(){var d;if(!this.currentCall)throw new Error("Call is not set");await((d=this.currentCall)==null?void 0:d.hangup())}reset(){this.client&&(this.client.off("ai.partial_result"),this.client.off("ai.speech_detect"),this.client.off("ai.completion"),this.client.off("ai.response_utterance"),this.client.disconnect()),this.currentCall=null,this.client=null,this.chat=null}};const be='<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="200px" width="200px" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08a.956.956 0 0 1-.29-.7c0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28a11.27 11.27 0 0 0-2.67-1.85.996.996 0 0 1-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"></path></svg>',He='<svg viewBox="0 0 24 24"><path fill="currentColor" d="M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z"></path></svg>',De=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z" fill="currentColor"/>
</svg> `,Oe=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" fill="currentColor"/>
</svg> `,de=`<svg xmlns="http://www.w3.org/000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
  <path d="M18 15l-6-6-6 6"/>
</svg> `,$e=F`
  <div name="controlsContainer">
    <div class="controls">
      <div class="control-group">
        <button class="control-button video-button" name="videoButton">
          <span class="muted-icon" style="display: none;">${'<svg  viewBox="0 0 24 24"><path fill="currentColor" d="M3.27,2L2,3.27L4.73,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16C16.2,18 16.39,17.92 16.54,17.82L19.73,21L21,19.73M21,6.5L17,10.5V7A1,1 0 0,0 16,6H9.82L21,17.18V6.5Z"></path></svg>'}</span>
          <span class="unmuted-icon">${He}</span>
        </button>
        <div class="device-select-wrapper">
          <button
            class="device-select-button video-devices-button"
            name="videoDevicesButton"
          >
            ${de}
          </button>
          <div
            class="device-menu"
            name="videoDevicesMenu"
            style="display: none;"
          >
            <!-- Populated via JS -->
          </div>
        </div>
      </div>

      <div class="control-group">
        <button class="control-button mic-button" name="micButton">
          <span class="muted-icon" style="display: none;"
            >${'<svg  viewBox="0 0 24 24"><title>microphone-off</title><path d="M19,11C19,12.19 18.66,13.3 18.1,14.28L16.87,13.05C17.14,12.43 17.3,11.74 17.3,11H19M15,11.16L9,5.18V5A3,3 0 0,1 12,2A3,3 0 0,1 15,5V11L15,11.16M4.27,3L21,19.73L19.73,21L15.54,16.81C14.77,17.27 13.91,17.58 13,17.72V21H11V17.72C7.72,17.23 5,14.41 5,11H6.7C6.7,14 9.24,16.1 12,16.1C12.81,16.1 13.6,15.91 14.31,15.58L12.65,13.92L12,14A3,3 0 0,1 9,11V10.28L3,4.27L4.27,3Z" style="fill: currentcolor;"></path></svg>'}</span
          >
          <span class="unmuted-icon">${De}</span>
        </button>
        <div class="device-select-wrapper">
          <button
            class="device-select-button mic-devices-button"
            name="micDevicesButton"
          >
            ${de}
          </button>
          <div class="device-menu" name="micDevicesMenu" style="display: none;">
            <!-- Populated via JS -->
          </div>
        </div>
      </div>

      <div class="control-group">
        <button class="control-button speaker-button" name="speakerButton">
          <span class="muted-icon" style="display: none;"
            >${'<svg viewBox="0 0 24 24"><path d="M12,4L9.91,6.09L12,8.18M4.27,3L3,4.27L7.73,9H3V15H7L12,20V13.27L16.25,17.53C15.58,18.04 14.83,18.46 14,18.7V20.77C15.38,20.45 16.63,19.82 17.68,18.96L19.73,21L21,19.73L12,10.73M19,12C19,12.94 18.8,13.82 18.46,14.64L19.97,16.15C20.62,14.91 21,13.5 21,12C21,7.72 18,4.14 14,3.23V5.29C16.89,6.15 19,8.83 19,12M16.5,12C16.5,10.23 15.5,8.71 14,7.97V10.18L16.45,12.63C16.5,12.43 16.5,12.21 16.5,12Z" style="fill: currentcolor;"></path></svg>'}</span
          >
          <span class="unmuted-icon">${Oe}</span>
        </button>
        <div class="device-select-wrapper">
          <button
            class="device-select-button speaker-devices-button"
            name="speakerDevicesButton"
          >
            ${de}
          </button>
          <div
            class="device-menu"
            name="speakerDevicesMenu"
            style="display: none;"
          >
            <!-- Populated via JS -->
          </div>
        </div>
      </div>

      <button class="control-button hangup" name="hangupButton">
        ${be}
      </button>
    </div>
  </div>
`,Ue=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M13.3333 4L6 11.3333L2.66667 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg> `;async function ne(j,d){O.onChange=P;const{controlsContainer:i,videoButton:r,micButton:f,speakerButton:h,hangupButton:v,videoDevicesButton:_,micDevicesButton:g,speakerDevicesButton:E,videoDevicesMenu:S,micDevicesMenu:M,speakerDevicesMenu:A}=$e(),k=i.closest(".audio-transcript-mode")!==null;d!=null&&d.supportsVideo||(r.style.display="none",_.style.display="none",S.style.display="none"),d!=null&&d.supportsAudio||(f.style.display="none",g.style.display="none",M.style.display="none",h.style.display="none",E.style.display="none",A.style.display="none");function P(){const{isVideoMuted:R,isAudioMuted:H,isSpeakerMuted:T,videoinput:e,audioinput:a,audiooutput:t,selectedCamera:n,selectedMicrophone:s,selectedSpeaker:c}=O.state;function o(l,y){const b=l.querySelector(".muted-icon"),p=l.querySelector(".unmuted-icon");b&&p&&(b.style.display=y?"block":"none",p.style.display=y?"none":"block")}d!=null&&d.supportsVideo&&o(r,R),d!=null&&d.supportsAudio&&(o(f,H),o(h,T)),!k&&(d!=null&&d.supportsVideo)&&(_.style.display=e.length>0?"block":"none",_.disabled=R,r.classList.toggle("standalone",e.length===0)),d!=null&&d.supportsAudio&&(g.style.display=a.length>0?"block":"none",g.disabled=H,f.classList.toggle("standalone",a.length===0),E.style.display=t.length>0?"block":"none",E.disabled=T,h.classList.toggle("standalone",t.length===0)),!k&&(d!=null&&d.supportsVideo)&&I(S,e,n,"camera"),d!=null&&d.supportsAudio&&(I(M,a,s,"microphone"),I(A,t,c,"speaker"))}function I(R,H,T,e){R.innerHTML=H.map(a=>`
      <div class="device-option ${a.deviceId===(T==null?void 0:T.deviceId)?"selected":""}" data-device-id="${a.deviceId}">
        ${a.deviceId===(T==null?void 0:T.deviceId)?Ue:""}
        ${a.label||`${e} ${H.indexOf(a)+1}`}
      </div>
    `).join("")}r.addEventListener("click",()=>O.toggleVideo()),f.addEventListener("click",()=>O.toggleAudio()),h.addEventListener("click",()=>O.toggleSpeaker()),v.addEventListener("click",()=>j==null?void 0:j());function D(R,H,T){R.addEventListener("click",e=>{e.stopPropagation(),[S,M,A].forEach(t=>{t!==H&&(t.style.display="none")}),H.style.display=H.style.display==="none"?"block":"none"}),H.addEventListener("click",async e=>{const a=e.target.closest(".device-option");if(a){const t=a.getAttribute("data-device-id");t&&(await T(t),H.style.display="none")}})}return D(_,S,R=>O.updateCamera(R)),D(g,M,R=>O.updateMicrophone(R)),D(E,A,R=>O.updateSpeaker(R)),document.addEventListener("click",()=>{S.style.display="none",M.style.display="none",A.style.display="none"}),P(),i}const qe=`<svg width="25" height="27" viewBox="0 0 25 27" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M25 26C14.5 14.5 12.5 4.5 12.5 0H0V13C0 13 10 26.5 25 26Z"/>
</svg>
`;function we(j){return j&&j.__esModule&&Object.prototype.hasOwnProperty.call(j,"default")?j.default:j}var ue,ve;function Fe(){if(ve)return ue;ve=1,r.notEqual=d,r.notOk=i,r.equal=j,r.ok=r,ue=r;function j(f,h,v){r(f==h,v)}function d(f,h,v){r(f!=h,v)}function i(f,h){r(!f,h)}function r(f,h){if(!f)throw new Error(h||"AssertionError")}return ue}var ie,_e;function We(){return _e||(_e=1,ie=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","onanimationend","onanimationiteration","onanimationstart","oncontextmenu","onfocusin","onfocusout"]),ie}var se,ke;function Ne(){if(ke)return se;ke=1;var j=We(),d=j.length,i=1,r=3,f=8;se=h;function h(A,k){var P=A.nodeType,I=A.nodeName;P===i&&v(A,k),(P===r||P===f)&&k.nodeValue!==A.nodeValue&&(k.nodeValue=A.nodeValue),I==="INPUT"?E(A,k):I==="OPTION"?g(A,k):I==="TEXTAREA"&&S(A,k),_(A,k)}function v(A,k){for(var P=k.attributes,I=A.attributes,D=null,R=null,H=null,T=null,e=null,a=I.length-1;a>=0;--a)e=I[a],T=e.name,D=e.namespaceURI,R=e.value,D?(T=e.localName||T,H=k.getAttributeNS(D,T),H!==R&&k.setAttributeNS(D,T,R)):k.hasAttribute(T)?(H=k.getAttribute(T),H!==R&&(R==="null"||R==="undefined"?k.removeAttribute(T):k.setAttribute(T,R))):k.setAttribute(T,R);for(var t=P.length-1;t>=0;--t)e=P[t],e.specified!==!1&&(T=e.name,D=e.namespaceURI,D?(T=e.localName||T,A.hasAttributeNS(D,T)||k.removeAttributeNS(D,T)):A.hasAttributeNS(null,T)||k.removeAttribute(T))}function _(A,k){for(var P=0;P<d;P++){var I=j[P];A[I]?k[I]=A[I]:k[I]&&(k[I]=void 0)}}function g(A,k){M(A,k,"selected")}function E(A,k){var P=A.value,I=k.value;M(A,k,"checked"),M(A,k,"disabled"),A.indeterminate!==k.indeterminate&&(k.indeterminate=A.indeterminate),k.type!=="file"&&(P!==I&&(k.setAttribute("value",P),k.value=P),P==="null"&&(k.value="",k.removeAttribute("value")),A.hasAttributeNS(null,"value")?k.type==="range"&&(k.value=P):k.removeAttribute("value"))}function S(A,k){var P=A.value;if(P!==k.value&&(k.value=P),k.firstChild&&k.firstChild.nodeValue!==P){if(P===""&&k.firstChild.nodeValue===k.placeholder)return;k.firstChild.nodeValue=P}}function M(A,k,P){A[P]!==k[P]&&(k[P]=A[P],A[P]?k.setAttribute(P,""):k.removeAttribute(P))}return se}var oe,ye;function xe(){if(ye)return oe;ye=1;var j=Fe(),d=Ne(),i=3;oe=r;function r(g,E,S){return j.equal(typeof g,"object","nanomorph: oldTree should be an object"),j.equal(typeof E,"object","nanomorph: newTree should be an object"),S&&S.childrenOnly?(v(E,g),g):(j.notEqual(E.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),f(E,g))}function f(g,E){return E?g?g.isSameNode&&g.isSameNode(E)?E:g.tagName!==E.tagName||h(g)!==h(E)?g:(d(g,E),v(g,E),E):null:g}function h(g){return g.dataset?g.dataset.nanomorphComponentId:void 0}function v(g,E){for(var S,M,A,k,P=0,I=0;S=E.childNodes[I],M=g.childNodes[I-P],!(!S&&!M);I++)if(!M)E.removeChild(S),I--;else if(!S)E.appendChild(M),P++;else if(_(M,S))A=f(M,S),A!==S&&(E.replaceChild(A,S),P++);else{k=null;for(var D=I;D<E.childNodes.length;D++)if(_(E.childNodes[D],M)){k=E.childNodes[D];break}k?(A=f(M,k),A!==k&&P++,E.insertBefore(A,S)):!M.id&&!S.id?(A=f(M,S),A!==S&&(E.replaceChild(A,S),P++)):(E.insertBefore(M,S),P++)}}function _(g,E){return g.id?g.id===E.id:g.isSameNode?g.isSameNode(E):g.tagName!==E.tagName?!1:g.type===i?g.nodeValue===E.nodeValue:!1}return oe}var Ge=xe();const Ze=we(Ge);var ee={exports:{}},Je=ee.exports,Ce;function Ke(){return Ce||(Ce=1,function(j){(function(){function d(e){var a={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Add a prefix to the generated header ids. Passing a string will prefix that string to the header id. Setting to true will add a generic 'section-' prefix",type:"string"},rawPrefixHeaderId:{defaultValue:!1,describe:'Setting this option to true will prevent showdown from modifying the prefix. This might result in malformed IDs (if, for instance, the " char is used in the prefix)',type:"boolean"},ghCompatibleHeaderId:{defaultValue:!1,describe:"Generate header ids compatible with github style (spaces are replaced with dashes, a bunch of non alphanumeric chars are removed)",type:"boolean"},rawHeaderId:{defaultValue:!1,describe:`Remove only spaces, ' and " from generated header ids (including prefixes), replacing them with dashes (-). WARNING: This might result in malformed ids`,type:"boolean"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},excludeTrailingPunctuationFromURLs:{defaultValue:!1,describe:"Excludes trailing punctuation from links generated with autoLinking",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},literalMidWordAsterisks:{defaultValue:!1,describe:"Parse midword asterisks as literal asterisks",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,describe:"Tries to smartly fix indentation in es6 strings",type:"boolean"},disableForced4SpacesIndentedSublists:{defaultValue:!1,describe:"Disables the requirement of indenting nested sublists by 4 spaces",type:"boolean"},simpleLineBreaks:{defaultValue:!1,describe:"Parses simple line breaks as <br> (GFM Style)",type:"boolean"},requireSpaceBeforeHeadingText:{defaultValue:!1,describe:"Makes adding a space between `#` and the header text mandatory (GFM Style)",type:"boolean"},ghMentions:{defaultValue:!1,describe:"Enables github @mentions",type:"boolean"},ghMentionsLink:{defaultValue:"https://github.com/{u}",describe:"Changes the link generated by @mentions. Only applies if ghMentions option is enabled.",type:"string"},encodeEmails:{defaultValue:!0,describe:"Encode e-mail addresses through the use of Character Entities, transforming ASCII e-mail addresses into its equivalent decimal entities",type:"boolean"},openLinksInNewWindow:{defaultValue:!1,describe:"Open all links in new windows",type:"boolean"},backslashEscapesHTMLTags:{defaultValue:!1,describe:"Support for HTML Tag escaping. ex: <div>foo</div>",type:"boolean"},emoji:{defaultValue:!1,describe:"Enable emoji support. Ex: `this is a :smile: emoji`",type:"boolean"},underline:{defaultValue:!1,describe:"Enable support for underline. Syntax is double or triple underscores: `__underline word__`. With this option enabled, underscores no longer parses into `<em>` and `<strong>`",type:"boolean"},ellipsis:{defaultValue:!0,describe:"Replaces three dots with the ellipsis unicode character",type:"boolean"},completeHTMLDocument:{defaultValue:!1,describe:"Outputs a complete html document, including `<html>`, `<head>` and `<body>` tags",type:"boolean"},metadata:{defaultValue:!1,describe:"Enable support for document metadata (defined at the top of the document between `«««` and `»»»` or between `---` and `---`).",type:"boolean"},splitAdjacentBlockquotes:{defaultValue:!1,describe:"Split adjacent blockquote blocks",type:"boolean"}};if(e===!1)return JSON.parse(JSON.stringify(a));var t={};for(var n in a)a.hasOwnProperty(n)&&(t[n]=a[n].defaultValue);return t}function i(){var e=d(!0),a={};for(var t in e)e.hasOwnProperty(t)&&(a[t]=!0);return a}var r={},f={},h={},v=d(!0),_="vanilla",g={github:{omitExtraWLInCodeBlocks:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,disableForced4SpacesIndentedSublists:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghCompatibleHeaderId:!0,ghMentions:!0,backslashEscapesHTMLTags:!0,emoji:!0,splitAdjacentBlockquotes:!0},original:{noHeaderId:!0,ghCodeBlocks:!1},ghost:{omitExtraWLInCodeBlocks:!0,parseImgDimensions:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,smoothLivePreview:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghMentions:!1,encodeEmails:!0},vanilla:d(!0),allOn:i()};r.helper={},r.extensions={},r.setOption=function(e,a){return v[e]=a,this},r.getOption=function(e){return v[e]},r.getOptions=function(){return v},r.resetOptions=function(){v=d(!0)},r.setFlavor=function(e){if(!g.hasOwnProperty(e))throw Error(e+" flavor was not found");r.resetOptions();var a=g[e];_=e;for(var t in a)a.hasOwnProperty(t)&&(v[t]=a[t])},r.getFlavor=function(){return _},r.getFlavorOptions=function(e){if(g.hasOwnProperty(e))return g[e]},r.getDefaultOptions=function(e){return d(e)},r.subParser=function(e,a){if(r.helper.isString(e))if(typeof a<"u")f[e]=a;else{if(f.hasOwnProperty(e))return f[e];throw Error("SubParser named "+e+" not registered!")}},r.extension=function(e,a){if(!r.helper.isString(e))throw Error("Extension 'name' must be a string");if(e=r.helper.stdExtName(e),r.helper.isUndefined(a)){if(!h.hasOwnProperty(e))throw Error("Extension named "+e+" is not registered!");return h[e]}else{typeof a=="function"&&(a=a()),r.helper.isArray(a)||(a=[a]);var t=E(a,e);if(t.valid)h[e]=a;else throw Error(t.error)}},r.getAllExtensions=function(){return h},r.removeExtension=function(e){delete h[e]},r.resetExtensions=function(){h={}};function E(e,a){var t=a?"Error in "+a+" extension->":"Error in unnamed extension",n={valid:!0,error:""};r.helper.isArray(e)||(e=[e]);for(var s=0;s<e.length;++s){var c=t+" sub-extension "+s+": ",o=e[s];if(typeof o!="object")return n.valid=!1,n.error=c+"must be an object, but "+typeof o+" given",n;if(!r.helper.isString(o.type))return n.valid=!1,n.error=c+'property "type" must be a string, but '+typeof o.type+" given",n;var l=o.type=o.type.toLowerCase();if(l==="language"&&(l=o.type="lang"),l==="html"&&(l=o.type="output"),l!=="lang"&&l!=="output"&&l!=="listener")return n.valid=!1,n.error=c+"type "+l+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',n;if(l==="listener"){if(r.helper.isUndefined(o.listeners))return n.valid=!1,n.error=c+'. Extensions of type "listener" must have a property called "listeners"',n}else if(r.helper.isUndefined(o.filter)&&r.helper.isUndefined(o.regex))return n.valid=!1,n.error=c+l+' extensions must define either a "regex" property or a "filter" method',n;if(o.listeners){if(typeof o.listeners!="object")return n.valid=!1,n.error=c+'"listeners" property must be an object but '+typeof o.listeners+" given",n;for(var y in o.listeners)if(o.listeners.hasOwnProperty(y)&&typeof o.listeners[y]!="function")return n.valid=!1,n.error=c+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+y+" must be a function but "+typeof o.listeners[y]+" given",n}if(o.filter){if(typeof o.filter!="function")return n.valid=!1,n.error=c+'"filter" must be a function, but '+typeof o.filter+" given",n}else if(o.regex){if(r.helper.isString(o.regex)&&(o.regex=new RegExp(o.regex,"g")),!(o.regex instanceof RegExp))return n.valid=!1,n.error=c+'"regex" property must either be a string or a RegExp object, but '+typeof o.regex+" given",n;if(r.helper.isUndefined(o.replace))return n.valid=!1,n.error=c+'"regex" extensions must implement a replace string or function',n}}return n}r.validateExtension=function(e){var a=E(e,null);return a.valid?!0:(console.warn(a.error),!1)},r.hasOwnProperty("helper")||(r.helper={}),r.helper.isString=function(e){return typeof e=="string"||e instanceof String},r.helper.isFunction=function(e){var a={};return e&&a.toString.call(e)==="[object Function]"},r.helper.isArray=function(e){return Array.isArray(e)},r.helper.isUndefined=function(e){return typeof e>"u"},r.helper.forEach=function(e,a){if(r.helper.isUndefined(e))throw new Error("obj param is required");if(r.helper.isUndefined(a))throw new Error("callback param is required");if(!r.helper.isFunction(a))throw new Error("callback param must be a function/closure");if(typeof e.forEach=="function")e.forEach(a);else if(r.helper.isArray(e))for(var t=0;t<e.length;t++)a(e[t],t,e);else if(typeof e=="object")for(var n in e)e.hasOwnProperty(n)&&a(e[n],n,e);else throw new Error("obj does not seem to be an array or an iterable object")},r.helper.stdExtName=function(e){return e.replace(/[_?*+\/\\.^-]/g,"").replace(/\s/g,"").toLowerCase()};function S(e,a){var t=a.charCodeAt(0);return"¨E"+t+"E"}r.helper.escapeCharactersCallback=S,r.helper.escapeCharacters=function(e,a,t){var n="(["+a.replace(/([\[\]\\])/g,"\\$1")+"])";t&&(n="\\\\"+n);var s=new RegExp(n,"g");return e=e.replace(s,S),e},r.helper.unescapeHTMLEntities=function(e){return e.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};var M=function(e,a,t,n){var s=n||"",c=s.indexOf("g")>-1,o=new RegExp(a+"|"+t,"g"+s.replace(/g/g,"")),l=new RegExp(a,s.replace(/g/g,"")),y=[],b,p,w,u,m;do for(b=0;w=o.exec(e);)if(l.test(w[0]))b++||(p=o.lastIndex,u=p-w[0].length);else if(b&&!--b){m=w.index+w[0].length;var L={left:{start:u,end:p},match:{start:p,end:w.index},right:{start:w.index,end:m},wholeMatch:{start:u,end:m}};if(y.push(L),!c)return y}while(b&&(o.lastIndex=p));return y};r.helper.matchRecursiveRegExp=function(e,a,t,n){for(var s=M(e,a,t,n),c=[],o=0;o<s.length;++o)c.push([e.slice(s[o].wholeMatch.start,s[o].wholeMatch.end),e.slice(s[o].match.start,s[o].match.end),e.slice(s[o].left.start,s[o].left.end),e.slice(s[o].right.start,s[o].right.end)]);return c},r.helper.replaceRecursiveRegExp=function(e,a,t,n,s){if(!r.helper.isFunction(a)){var c=a;a=function(){return c}}var o=M(e,t,n,s),l=e,y=o.length;if(y>0){var b=[];o[0].wholeMatch.start!==0&&b.push(e.slice(0,o[0].wholeMatch.start));for(var p=0;p<y;++p)b.push(a(e.slice(o[p].wholeMatch.start,o[p].wholeMatch.end),e.slice(o[p].match.start,o[p].match.end),e.slice(o[p].left.start,o[p].left.end),e.slice(o[p].right.start,o[p].right.end))),p<y-1&&b.push(e.slice(o[p].wholeMatch.end,o[p+1].wholeMatch.start));o[y-1].wholeMatch.end<e.length&&b.push(e.slice(o[y-1].wholeMatch.end)),l=b.join("")}return l},r.helper.regexIndexOf=function(e,a,t){if(!r.helper.isString(e))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";if(!(a instanceof RegExp))throw"InvalidArgumentError: second parameter of showdown.helper.regexIndexOf function must be an instance of RegExp";var n=e.substring(t||0).search(a);return n>=0?n+(t||0):n},r.helper.splitAtIndex=function(e,a){if(!r.helper.isString(e))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";return[e.substring(0,a),e.substring(a)]},r.helper.encodeEmailAddress=function(e){var a=[function(t){return"&#"+t.charCodeAt(0)+";"},function(t){return"&#x"+t.charCodeAt(0).toString(16)+";"},function(t){return t}];return e=e.replace(/./g,function(t){if(t==="@")t=a[Math.floor(Math.random()*2)](t);else{var n=Math.random();t=n>.9?a[2](t):n>.45?a[1](t):a[0](t)}return t}),e},r.helper.padEnd=function(a,t,n){return t=t>>0,n=String(n||" "),a.length>t?String(a):(t=t-a.length,t>n.length&&(n+=n.repeat(t/n.length)),String(a)+n.slice(0,t))},typeof console>"u"&&(console={warn:function(e){alert(e)},log:function(e){alert(e)},error:function(e){throw e}}),r.helper.regexes={asteriskDashAndColon:/([*_:~])/g},r.helper.emojis={"+1":"👍","-1":"👎",100:"💯",1234:"🔢","1st_place_medal":"🥇","2nd_place_medal":"🥈","3rd_place_medal":"🥉","8ball":"🎱",a:"🅰️",ab:"🆎",abc:"🔤",abcd:"🔡",accept:"🉑",aerial_tramway:"🚡",airplane:"✈️",alarm_clock:"⏰",alembic:"⚗️",alien:"👽",ambulance:"🚑",amphora:"🏺",anchor:"⚓️",angel:"👼",anger:"💢",angry:"😠",anguished:"😧",ant:"🐜",apple:"🍎",aquarius:"♒️",aries:"♈️",arrow_backward:"◀️",arrow_double_down:"⏬",arrow_double_up:"⏫",arrow_down:"⬇️",arrow_down_small:"🔽",arrow_forward:"▶️",arrow_heading_down:"⤵️",arrow_heading_up:"⤴️",arrow_left:"⬅️",arrow_lower_left:"↙️",arrow_lower_right:"↘️",arrow_right:"➡️",arrow_right_hook:"↪️",arrow_up:"⬆️",arrow_up_down:"↕️",arrow_up_small:"🔼",arrow_upper_left:"↖️",arrow_upper_right:"↗️",arrows_clockwise:"🔃",arrows_counterclockwise:"🔄",art:"🎨",articulated_lorry:"🚛",artificial_satellite:"🛰",astonished:"😲",athletic_shoe:"👟",atm:"🏧",atom_symbol:"⚛️",avocado:"🥑",b:"🅱️",baby:"👶",baby_bottle:"🍼",baby_chick:"🐤",baby_symbol:"🚼",back:"🔙",bacon:"🥓",badminton:"🏸",baggage_claim:"🛄",baguette_bread:"🥖",balance_scale:"⚖️",balloon:"🎈",ballot_box:"🗳",ballot_box_with_check:"☑️",bamboo:"🎍",banana:"🍌",bangbang:"‼️",bank:"🏦",bar_chart:"📊",barber:"💈",baseball:"⚾️",basketball:"🏀",basketball_man:"⛹️",basketball_woman:"⛹️&zwj;♀️",bat:"🦇",bath:"🛀",bathtub:"🛁",battery:"🔋",beach_umbrella:"🏖",bear:"🐻",bed:"🛏",bee:"🐝",beer:"🍺",beers:"🍻",beetle:"🐞",beginner:"🔰",bell:"🔔",bellhop_bell:"🛎",bento:"🍱",biking_man:"🚴",bike:"🚲",biking_woman:"🚴&zwj;♀️",bikini:"👙",biohazard:"☣️",bird:"🐦",birthday:"🎂",black_circle:"⚫️",black_flag:"🏴",black_heart:"🖤",black_joker:"🃏",black_large_square:"⬛️",black_medium_small_square:"◾️",black_medium_square:"◼️",black_nib:"✒️",black_small_square:"▪️",black_square_button:"🔲",blonde_man:"👱",blonde_woman:"👱&zwj;♀️",blossom:"🌼",blowfish:"🐡",blue_book:"📘",blue_car:"🚙",blue_heart:"💙",blush:"😊",boar:"🐗",boat:"⛵️",bomb:"💣",book:"📖",bookmark:"🔖",bookmark_tabs:"📑",books:"📚",boom:"💥",boot:"👢",bouquet:"💐",bowing_man:"🙇",bow_and_arrow:"🏹",bowing_woman:"🙇&zwj;♀️",bowling:"🎳",boxing_glove:"🥊",boy:"👦",bread:"🍞",bride_with_veil:"👰",bridge_at_night:"🌉",briefcase:"💼",broken_heart:"💔",bug:"🐛",building_construction:"🏗",bulb:"💡",bullettrain_front:"🚅",bullettrain_side:"🚄",burrito:"🌯",bus:"🚌",business_suit_levitating:"🕴",busstop:"🚏",bust_in_silhouette:"👤",busts_in_silhouette:"👥",butterfly:"🦋",cactus:"🌵",cake:"🍰",calendar:"📆",call_me_hand:"🤙",calling:"📲",camel:"🐫",camera:"📷",camera_flash:"📸",camping:"🏕",cancer:"♋️",candle:"🕯",candy:"🍬",canoe:"🛶",capital_abcd:"🔠",capricorn:"♑️",car:"🚗",card_file_box:"🗃",card_index:"📇",card_index_dividers:"🗂",carousel_horse:"🎠",carrot:"🥕",cat:"🐱",cat2:"🐈",cd:"💿",chains:"⛓",champagne:"🍾",chart:"💹",chart_with_downwards_trend:"📉",chart_with_upwards_trend:"📈",checkered_flag:"🏁",cheese:"🧀",cherries:"🍒",cherry_blossom:"🌸",chestnut:"🌰",chicken:"🐔",children_crossing:"🚸",chipmunk:"🐿",chocolate_bar:"🍫",christmas_tree:"🎄",church:"⛪️",cinema:"🎦",circus_tent:"🎪",city_sunrise:"🌇",city_sunset:"🌆",cityscape:"🏙",cl:"🆑",clamp:"🗜",clap:"👏",clapper:"🎬",classical_building:"🏛",clinking_glasses:"🥂",clipboard:"📋",clock1:"🕐",clock10:"🕙",clock1030:"🕥",clock11:"🕚",clock1130:"🕦",clock12:"🕛",clock1230:"🕧",clock130:"🕜",clock2:"🕑",clock230:"🕝",clock3:"🕒",clock330:"🕞",clock4:"🕓",clock430:"🕟",clock5:"🕔",clock530:"🕠",clock6:"🕕",clock630:"🕡",clock7:"🕖",clock730:"🕢",clock8:"🕗",clock830:"🕣",clock9:"🕘",clock930:"🕤",closed_book:"📕",closed_lock_with_key:"🔐",closed_umbrella:"🌂",cloud:"☁️",cloud_with_lightning:"🌩",cloud_with_lightning_and_rain:"⛈",cloud_with_rain:"🌧",cloud_with_snow:"🌨",clown_face:"🤡",clubs:"♣️",cocktail:"🍸",coffee:"☕️",coffin:"⚰️",cold_sweat:"😰",comet:"☄️",computer:"💻",computer_mouse:"🖱",confetti_ball:"🎊",confounded:"😖",confused:"😕",congratulations:"㊗️",construction:"🚧",construction_worker_man:"👷",construction_worker_woman:"👷&zwj;♀️",control_knobs:"🎛",convenience_store:"🏪",cookie:"🍪",cool:"🆒",policeman:"👮",copyright:"©️",corn:"🌽",couch_and_lamp:"🛋",couple:"👫",couple_with_heart_woman_man:"💑",couple_with_heart_man_man:"👨&zwj;❤️&zwj;👨",couple_with_heart_woman_woman:"👩&zwj;❤️&zwj;👩",couplekiss_man_man:"👨&zwj;❤️&zwj;💋&zwj;👨",couplekiss_man_woman:"💏",couplekiss_woman_woman:"👩&zwj;❤️&zwj;💋&zwj;👩",cow:"🐮",cow2:"🐄",cowboy_hat_face:"🤠",crab:"🦀",crayon:"🖍",credit_card:"💳",crescent_moon:"🌙",cricket:"🏏",crocodile:"🐊",croissant:"🥐",crossed_fingers:"🤞",crossed_flags:"🎌",crossed_swords:"⚔️",crown:"👑",cry:"😢",crying_cat_face:"😿",crystal_ball:"🔮",cucumber:"🥒",cupid:"💘",curly_loop:"➰",currency_exchange:"💱",curry:"🍛",custard:"🍮",customs:"🛃",cyclone:"🌀",dagger:"🗡",dancer:"💃",dancing_women:"👯",dancing_men:"👯&zwj;♂️",dango:"🍡",dark_sunglasses:"🕶",dart:"🎯",dash:"💨",date:"📅",deciduous_tree:"🌳",deer:"🦌",department_store:"🏬",derelict_house:"🏚",desert:"🏜",desert_island:"🏝",desktop_computer:"🖥",male_detective:"🕵️",diamond_shape_with_a_dot_inside:"💠",diamonds:"♦️",disappointed:"😞",disappointed_relieved:"😥",dizzy:"💫",dizzy_face:"😵",do_not_litter:"🚯",dog:"🐶",dog2:"🐕",dollar:"💵",dolls:"🎎",dolphin:"🐬",door:"🚪",doughnut:"🍩",dove:"🕊",dragon:"🐉",dragon_face:"🐲",dress:"👗",dromedary_camel:"🐪",drooling_face:"🤤",droplet:"💧",drum:"🥁",duck:"🦆",dvd:"📀","e-mail":"📧",eagle:"🦅",ear:"👂",ear_of_rice:"🌾",earth_africa:"🌍",earth_americas:"🌎",earth_asia:"🌏",egg:"🥚",eggplant:"🍆",eight_pointed_black_star:"✴️",eight_spoked_asterisk:"✳️",electric_plug:"🔌",elephant:"🐘",email:"✉️",end:"🔚",envelope_with_arrow:"📩",euro:"💶",european_castle:"🏰",european_post_office:"🏤",evergreen_tree:"🌲",exclamation:"❗️",expressionless:"😑",eye:"👁",eye_speech_bubble:"👁&zwj;🗨",eyeglasses:"👓",eyes:"👀",face_with_head_bandage:"🤕",face_with_thermometer:"🤒",fist_oncoming:"👊",factory:"🏭",fallen_leaf:"🍂",family_man_woman_boy:"👪",family_man_boy:"👨&zwj;👦",family_man_boy_boy:"👨&zwj;👦&zwj;👦",family_man_girl:"👨&zwj;👧",family_man_girl_boy:"👨&zwj;👧&zwj;👦",family_man_girl_girl:"👨&zwj;👧&zwj;👧",family_man_man_boy:"👨&zwj;👨&zwj;👦",family_man_man_boy_boy:"👨&zwj;👨&zwj;👦&zwj;👦",family_man_man_girl:"👨&zwj;👨&zwj;👧",family_man_man_girl_boy:"👨&zwj;👨&zwj;👧&zwj;👦",family_man_man_girl_girl:"👨&zwj;👨&zwj;👧&zwj;👧",family_man_woman_boy_boy:"👨&zwj;👩&zwj;👦&zwj;👦",family_man_woman_girl:"👨&zwj;👩&zwj;👧",family_man_woman_girl_boy:"👨&zwj;👩&zwj;👧&zwj;👦",family_man_woman_girl_girl:"👨&zwj;👩&zwj;👧&zwj;👧",family_woman_boy:"👩&zwj;👦",family_woman_boy_boy:"👩&zwj;👦&zwj;👦",family_woman_girl:"👩&zwj;👧",family_woman_girl_boy:"👩&zwj;👧&zwj;👦",family_woman_girl_girl:"👩&zwj;👧&zwj;👧",family_woman_woman_boy:"👩&zwj;👩&zwj;👦",family_woman_woman_boy_boy:"👩&zwj;👩&zwj;👦&zwj;👦",family_woman_woman_girl:"👩&zwj;👩&zwj;👧",family_woman_woman_girl_boy:"👩&zwj;👩&zwj;👧&zwj;👦",family_woman_woman_girl_girl:"👩&zwj;👩&zwj;👧&zwj;👧",fast_forward:"⏩",fax:"📠",fearful:"😨",feet:"🐾",female_detective:"🕵️&zwj;♀️",ferris_wheel:"🎡",ferry:"⛴",field_hockey:"🏑",file_cabinet:"🗄",file_folder:"📁",film_projector:"📽",film_strip:"🎞",fire:"🔥",fire_engine:"🚒",fireworks:"🎆",first_quarter_moon:"🌓",first_quarter_moon_with_face:"🌛",fish:"🐟",fish_cake:"🍥",fishing_pole_and_fish:"🎣",fist_raised:"✊",fist_left:"🤛",fist_right:"🤜",flags:"🎏",flashlight:"🔦",fleur_de_lis:"⚜️",flight_arrival:"🛬",flight_departure:"🛫",floppy_disk:"💾",flower_playing_cards:"🎴",flushed:"😳",fog:"🌫",foggy:"🌁",football:"🏈",footprints:"👣",fork_and_knife:"🍴",fountain:"⛲️",fountain_pen:"🖋",four_leaf_clover:"🍀",fox_face:"🦊",framed_picture:"🖼",free:"🆓",fried_egg:"🍳",fried_shrimp:"🍤",fries:"🍟",frog:"🐸",frowning:"😦",frowning_face:"☹️",frowning_man:"🙍&zwj;♂️",frowning_woman:"🙍",middle_finger:"🖕",fuelpump:"⛽️",full_moon:"🌕",full_moon_with_face:"🌝",funeral_urn:"⚱️",game_die:"🎲",gear:"⚙️",gem:"💎",gemini:"♊️",ghost:"👻",gift:"🎁",gift_heart:"💝",girl:"👧",globe_with_meridians:"🌐",goal_net:"🥅",goat:"🐐",golf:"⛳️",golfing_man:"🏌️",golfing_woman:"🏌️&zwj;♀️",gorilla:"🦍",grapes:"🍇",green_apple:"🍏",green_book:"📗",green_heart:"💚",green_salad:"🥗",grey_exclamation:"❕",grey_question:"❔",grimacing:"😬",grin:"😁",grinning:"😀",guardsman:"💂",guardswoman:"💂&zwj;♀️",guitar:"🎸",gun:"🔫",haircut_woman:"💇",haircut_man:"💇&zwj;♂️",hamburger:"🍔",hammer:"🔨",hammer_and_pick:"⚒",hammer_and_wrench:"🛠",hamster:"🐹",hand:"✋",handbag:"👜",handshake:"🤝",hankey:"💩",hatched_chick:"🐥",hatching_chick:"🐣",headphones:"🎧",hear_no_evil:"🙉",heart:"❤️",heart_decoration:"💟",heart_eyes:"😍",heart_eyes_cat:"😻",heartbeat:"💓",heartpulse:"💗",hearts:"♥️",heavy_check_mark:"✔️",heavy_division_sign:"➗",heavy_dollar_sign:"💲",heavy_heart_exclamation:"❣️",heavy_minus_sign:"➖",heavy_multiplication_x:"✖️",heavy_plus_sign:"➕",helicopter:"🚁",herb:"🌿",hibiscus:"🌺",high_brightness:"🔆",high_heel:"👠",hocho:"🔪",hole:"🕳",honey_pot:"🍯",horse:"🐴",horse_racing:"🏇",hospital:"🏥",hot_pepper:"🌶",hotdog:"🌭",hotel:"🏨",hotsprings:"♨️",hourglass:"⌛️",hourglass_flowing_sand:"⏳",house:"🏠",house_with_garden:"🏡",houses:"🏘",hugs:"🤗",hushed:"😯",ice_cream:"🍨",ice_hockey:"🏒",ice_skate:"⛸",icecream:"🍦",id:"🆔",ideograph_advantage:"🉐",imp:"👿",inbox_tray:"📥",incoming_envelope:"📨",tipping_hand_woman:"💁",information_source:"ℹ️",innocent:"😇",interrobang:"⁉️",iphone:"📱",izakaya_lantern:"🏮",jack_o_lantern:"🎃",japan:"🗾",japanese_castle:"🏯",japanese_goblin:"👺",japanese_ogre:"👹",jeans:"👖",joy:"😂",joy_cat:"😹",joystick:"🕹",kaaba:"🕋",key:"🔑",keyboard:"⌨️",keycap_ten:"🔟",kick_scooter:"🛴",kimono:"👘",kiss:"💋",kissing:"😗",kissing_cat:"😽",kissing_closed_eyes:"😚",kissing_heart:"😘",kissing_smiling_eyes:"😙",kiwi_fruit:"🥝",koala:"🐨",koko:"🈁",label:"🏷",large_blue_circle:"🔵",large_blue_diamond:"🔷",large_orange_diamond:"🔶",last_quarter_moon:"🌗",last_quarter_moon_with_face:"🌜",latin_cross:"✝️",laughing:"😆",leaves:"🍃",ledger:"📒",left_luggage:"🛅",left_right_arrow:"↔️",leftwards_arrow_with_hook:"↩️",lemon:"🍋",leo:"♌️",leopard:"🐆",level_slider:"🎚",libra:"♎️",light_rail:"🚈",link:"🔗",lion:"🦁",lips:"👄",lipstick:"💄",lizard:"🦎",lock:"🔒",lock_with_ink_pen:"🔏",lollipop:"🍭",loop:"➿",loud_sound:"🔊",loudspeaker:"📢",love_hotel:"🏩",love_letter:"💌",low_brightness:"🔅",lying_face:"🤥",m:"Ⓜ️",mag:"🔍",mag_right:"🔎",mahjong:"🀄️",mailbox:"📫",mailbox_closed:"📪",mailbox_with_mail:"📬",mailbox_with_no_mail:"📭",man:"👨",man_artist:"👨&zwj;🎨",man_astronaut:"👨&zwj;🚀",man_cartwheeling:"🤸&zwj;♂️",man_cook:"👨&zwj;🍳",man_dancing:"🕺",man_facepalming:"🤦&zwj;♂️",man_factory_worker:"👨&zwj;🏭",man_farmer:"👨&zwj;🌾",man_firefighter:"👨&zwj;🚒",man_health_worker:"👨&zwj;⚕️",man_in_tuxedo:"🤵",man_judge:"👨&zwj;⚖️",man_juggling:"🤹&zwj;♂️",man_mechanic:"👨&zwj;🔧",man_office_worker:"👨&zwj;💼",man_pilot:"👨&zwj;✈️",man_playing_handball:"🤾&zwj;♂️",man_playing_water_polo:"🤽&zwj;♂️",man_scientist:"👨&zwj;🔬",man_shrugging:"🤷&zwj;♂️",man_singer:"👨&zwj;🎤",man_student:"👨&zwj;🎓",man_teacher:"👨&zwj;🏫",man_technologist:"👨&zwj;💻",man_with_gua_pi_mao:"👲",man_with_turban:"👳",tangerine:"🍊",mans_shoe:"👞",mantelpiece_clock:"🕰",maple_leaf:"🍁",martial_arts_uniform:"🥋",mask:"😷",massage_woman:"💆",massage_man:"💆&zwj;♂️",meat_on_bone:"🍖",medal_military:"🎖",medal_sports:"🏅",mega:"📣",melon:"🍈",memo:"📝",men_wrestling:"🤼&zwj;♂️",menorah:"🕎",mens:"🚹",metal:"🤘",metro:"🚇",microphone:"🎤",microscope:"🔬",milk_glass:"🥛",milky_way:"🌌",minibus:"🚐",minidisc:"💽",mobile_phone_off:"📴",money_mouth_face:"🤑",money_with_wings:"💸",moneybag:"💰",monkey:"🐒",monkey_face:"🐵",monorail:"🚝",moon:"🌔",mortar_board:"🎓",mosque:"🕌",motor_boat:"🛥",motor_scooter:"🛵",motorcycle:"🏍",motorway:"🛣",mount_fuji:"🗻",mountain:"⛰",mountain_biking_man:"🚵",mountain_biking_woman:"🚵&zwj;♀️",mountain_cableway:"🚠",mountain_railway:"🚞",mountain_snow:"🏔",mouse:"🐭",mouse2:"🐁",movie_camera:"🎥",moyai:"🗿",mrs_claus:"🤶",muscle:"💪",mushroom:"🍄",musical_keyboard:"🎹",musical_note:"🎵",musical_score:"🎼",mute:"🔇",nail_care:"💅",name_badge:"📛",national_park:"🏞",nauseated_face:"🤢",necktie:"👔",negative_squared_cross_mark:"❎",nerd_face:"🤓",neutral_face:"😐",new:"🆕",new_moon:"🌑",new_moon_with_face:"🌚",newspaper:"📰",newspaper_roll:"🗞",next_track_button:"⏭",ng:"🆖",no_good_man:"🙅&zwj;♂️",no_good_woman:"🙅",night_with_stars:"🌃",no_bell:"🔕",no_bicycles:"🚳",no_entry:"⛔️",no_entry_sign:"🚫",no_mobile_phones:"📵",no_mouth:"😶",no_pedestrians:"🚷",no_smoking:"🚭","non-potable_water":"🚱",nose:"👃",notebook:"📓",notebook_with_decorative_cover:"📔",notes:"🎶",nut_and_bolt:"🔩",o:"⭕️",o2:"🅾️",ocean:"🌊",octopus:"🐙",oden:"🍢",office:"🏢",oil_drum:"🛢",ok:"🆗",ok_hand:"👌",ok_man:"🙆&zwj;♂️",ok_woman:"🙆",old_key:"🗝",older_man:"👴",older_woman:"👵",om:"🕉",on:"🔛",oncoming_automobile:"🚘",oncoming_bus:"🚍",oncoming_police_car:"🚔",oncoming_taxi:"🚖",open_file_folder:"📂",open_hands:"👐",open_mouth:"😮",open_umbrella:"☂️",ophiuchus:"⛎",orange_book:"📙",orthodox_cross:"☦️",outbox_tray:"📤",owl:"🦉",ox:"🐂",package:"📦",page_facing_up:"📄",page_with_curl:"📃",pager:"📟",paintbrush:"🖌",palm_tree:"🌴",pancakes:"🥞",panda_face:"🐼",paperclip:"📎",paperclips:"🖇",parasol_on_ground:"⛱",parking:"🅿️",part_alternation_mark:"〽️",partly_sunny:"⛅️",passenger_ship:"🛳",passport_control:"🛂",pause_button:"⏸",peace_symbol:"☮️",peach:"🍑",peanuts:"🥜",pear:"🍐",pen:"🖊",pencil2:"✏️",penguin:"🐧",pensive:"😔",performing_arts:"🎭",persevere:"😣",person_fencing:"🤺",pouting_woman:"🙎",phone:"☎️",pick:"⛏",pig:"🐷",pig2:"🐖",pig_nose:"🐽",pill:"💊",pineapple:"🍍",ping_pong:"🏓",pisces:"♓️",pizza:"🍕",place_of_worship:"🛐",plate_with_cutlery:"🍽",play_or_pause_button:"⏯",point_down:"👇",point_left:"👈",point_right:"👉",point_up:"☝️",point_up_2:"👆",police_car:"🚓",policewoman:"👮&zwj;♀️",poodle:"🐩",popcorn:"🍿",post_office:"🏣",postal_horn:"📯",postbox:"📮",potable_water:"🚰",potato:"🥔",pouch:"👝",poultry_leg:"🍗",pound:"💷",rage:"😡",pouting_cat:"😾",pouting_man:"🙎&zwj;♂️",pray:"🙏",prayer_beads:"📿",pregnant_woman:"🤰",previous_track_button:"⏮",prince:"🤴",princess:"👸",printer:"🖨",purple_heart:"💜",purse:"👛",pushpin:"📌",put_litter_in_its_place:"🚮",question:"❓",rabbit:"🐰",rabbit2:"🐇",racehorse:"🐎",racing_car:"🏎",radio:"📻",radio_button:"🔘",radioactive:"☢️",railway_car:"🚃",railway_track:"🛤",rainbow:"🌈",rainbow_flag:"🏳️&zwj;🌈",raised_back_of_hand:"🤚",raised_hand_with_fingers_splayed:"🖐",raised_hands:"🙌",raising_hand_woman:"🙋",raising_hand_man:"🙋&zwj;♂️",ram:"🐏",ramen:"🍜",rat:"🐀",record_button:"⏺",recycle:"♻️",red_circle:"🔴",registered:"®️",relaxed:"☺️",relieved:"😌",reminder_ribbon:"🎗",repeat:"🔁",repeat_one:"🔂",rescue_worker_helmet:"⛑",restroom:"🚻",revolving_hearts:"💞",rewind:"⏪",rhinoceros:"🦏",ribbon:"🎀",rice:"🍚",rice_ball:"🍙",rice_cracker:"🍘",rice_scene:"🎑",right_anger_bubble:"🗯",ring:"💍",robot:"🤖",rocket:"🚀",rofl:"🤣",roll_eyes:"🙄",roller_coaster:"🎢",rooster:"🐓",rose:"🌹",rosette:"🏵",rotating_light:"🚨",round_pushpin:"📍",rowing_man:"🚣",rowing_woman:"🚣&zwj;♀️",rugby_football:"🏉",running_man:"🏃",running_shirt_with_sash:"🎽",running_woman:"🏃&zwj;♀️",sa:"🈂️",sagittarius:"♐️",sake:"🍶",sandal:"👡",santa:"🎅",satellite:"📡",saxophone:"🎷",school:"🏫",school_satchel:"🎒",scissors:"✂️",scorpion:"🦂",scorpius:"♏️",scream:"😱",scream_cat:"🙀",scroll:"📜",seat:"💺",secret:"㊙️",see_no_evil:"🙈",seedling:"🌱",selfie:"🤳",shallow_pan_of_food:"🥘",shamrock:"☘️",shark:"🦈",shaved_ice:"🍧",sheep:"🐑",shell:"🐚",shield:"🛡",shinto_shrine:"⛩",ship:"🚢",shirt:"👕",shopping:"🛍",shopping_cart:"🛒",shower:"🚿",shrimp:"🦐",signal_strength:"📶",six_pointed_star:"🔯",ski:"🎿",skier:"⛷",skull:"💀",skull_and_crossbones:"☠️",sleeping:"😴",sleeping_bed:"🛌",sleepy:"😪",slightly_frowning_face:"🙁",slightly_smiling_face:"🙂",slot_machine:"🎰",small_airplane:"🛩",small_blue_diamond:"🔹",small_orange_diamond:"🔸",small_red_triangle:"🔺",small_red_triangle_down:"🔻",smile:"😄",smile_cat:"😸",smiley:"😃",smiley_cat:"😺",smiling_imp:"😈",smirk:"😏",smirk_cat:"😼",smoking:"🚬",snail:"🐌",snake:"🐍",sneezing_face:"🤧",snowboarder:"🏂",snowflake:"❄️",snowman:"⛄️",snowman_with_snow:"☃️",sob:"😭",soccer:"⚽️",soon:"🔜",sos:"🆘",sound:"🔉",space_invader:"👾",spades:"♠️",spaghetti:"🍝",sparkle:"❇️",sparkler:"🎇",sparkles:"✨",sparkling_heart:"💖",speak_no_evil:"🙊",speaker:"🔈",speaking_head:"🗣",speech_balloon:"💬",speedboat:"🚤",spider:"🕷",spider_web:"🕸",spiral_calendar:"🗓",spiral_notepad:"🗒",spoon:"🥄",squid:"🦑",stadium:"🏟",star:"⭐️",star2:"🌟",star_and_crescent:"☪️",star_of_david:"✡️",stars:"🌠",station:"🚉",statue_of_liberty:"🗽",steam_locomotive:"🚂",stew:"🍲",stop_button:"⏹",stop_sign:"🛑",stopwatch:"⏱",straight_ruler:"📏",strawberry:"🍓",stuck_out_tongue:"😛",stuck_out_tongue_closed_eyes:"😝",stuck_out_tongue_winking_eye:"😜",studio_microphone:"🎙",stuffed_flatbread:"🥙",sun_behind_large_cloud:"🌥",sun_behind_rain_cloud:"🌦",sun_behind_small_cloud:"🌤",sun_with_face:"🌞",sunflower:"🌻",sunglasses:"😎",sunny:"☀️",sunrise:"🌅",sunrise_over_mountains:"🌄",surfing_man:"🏄",surfing_woman:"🏄&zwj;♀️",sushi:"🍣",suspension_railway:"🚟",sweat:"😓",sweat_drops:"💦",sweat_smile:"😅",sweet_potato:"🍠",swimming_man:"🏊",swimming_woman:"🏊&zwj;♀️",symbols:"🔣",synagogue:"🕍",syringe:"💉",taco:"🌮",tada:"🎉",tanabata_tree:"🎋",taurus:"♉️",taxi:"🚕",tea:"🍵",telephone_receiver:"📞",telescope:"🔭",tennis:"🎾",tent:"⛺️",thermometer:"🌡",thinking:"🤔",thought_balloon:"💭",ticket:"🎫",tickets:"🎟",tiger:"🐯",tiger2:"🐅",timer_clock:"⏲",tipping_hand_man:"💁&zwj;♂️",tired_face:"😫",tm:"™️",toilet:"🚽",tokyo_tower:"🗼",tomato:"🍅",tongue:"👅",top:"🔝",tophat:"🎩",tornado:"🌪",trackball:"🖲",tractor:"🚜",traffic_light:"🚥",train:"🚋",train2:"🚆",tram:"🚊",triangular_flag_on_post:"🚩",triangular_ruler:"📐",trident:"🔱",triumph:"😤",trolleybus:"🚎",trophy:"🏆",tropical_drink:"🍹",tropical_fish:"🐠",truck:"🚚",trumpet:"🎺",tulip:"🌷",tumbler_glass:"🥃",turkey:"🦃",turtle:"🐢",tv:"📺",twisted_rightwards_arrows:"🔀",two_hearts:"💕",two_men_holding_hands:"👬",two_women_holding_hands:"👭",u5272:"🈹",u5408:"🈴",u55b6:"🈺",u6307:"🈯️",u6708:"🈷️",u6709:"🈶",u6e80:"🈵",u7121:"🈚️",u7533:"🈸",u7981:"🈲",u7a7a:"🈳",umbrella:"☔️",unamused:"😒",underage:"🔞",unicorn:"🦄",unlock:"🔓",up:"🆙",upside_down_face:"🙃",v:"✌️",vertical_traffic_light:"🚦",vhs:"📼",vibration_mode:"📳",video_camera:"📹",video_game:"🎮",violin:"🎻",virgo:"♍️",volcano:"🌋",volleyball:"🏐",vs:"🆚",vulcan_salute:"🖖",walking_man:"🚶",walking_woman:"🚶&zwj;♀️",waning_crescent_moon:"🌘",waning_gibbous_moon:"🌖",warning:"⚠️",wastebasket:"🗑",watch:"⌚️",water_buffalo:"🐃",watermelon:"🍉",wave:"👋",wavy_dash:"〰️",waxing_crescent_moon:"🌒",wc:"🚾",weary:"😩",wedding:"💒",weight_lifting_man:"🏋️",weight_lifting_woman:"🏋️&zwj;♀️",whale:"🐳",whale2:"🐋",wheel_of_dharma:"☸️",wheelchair:"♿️",white_check_mark:"✅",white_circle:"⚪️",white_flag:"🏳️",white_flower:"💮",white_large_square:"⬜️",white_medium_small_square:"◽️",white_medium_square:"◻️",white_small_square:"▫️",white_square_button:"🔳",wilted_flower:"🥀",wind_chime:"🎐",wind_face:"🌬",wine_glass:"🍷",wink:"😉",wolf:"🐺",woman:"👩",woman_artist:"👩&zwj;🎨",woman_astronaut:"👩&zwj;🚀",woman_cartwheeling:"🤸&zwj;♀️",woman_cook:"👩&zwj;🍳",woman_facepalming:"🤦&zwj;♀️",woman_factory_worker:"👩&zwj;🏭",woman_farmer:"👩&zwj;🌾",woman_firefighter:"👩&zwj;🚒",woman_health_worker:"👩&zwj;⚕️",woman_judge:"👩&zwj;⚖️",woman_juggling:"🤹&zwj;♀️",woman_mechanic:"👩&zwj;🔧",woman_office_worker:"👩&zwj;💼",woman_pilot:"👩&zwj;✈️",woman_playing_handball:"🤾&zwj;♀️",woman_playing_water_polo:"🤽&zwj;♀️",woman_scientist:"👩&zwj;🔬",woman_shrugging:"🤷&zwj;♀️",woman_singer:"👩&zwj;🎤",woman_student:"👩&zwj;🎓",woman_teacher:"👩&zwj;🏫",woman_technologist:"👩&zwj;💻",woman_with_turban:"👳&zwj;♀️",womans_clothes:"👚",womans_hat:"👒",women_wrestling:"🤼&zwj;♀️",womens:"🚺",world_map:"🗺",worried:"😟",wrench:"🔧",writing_hand:"✍️",x:"❌",yellow_heart:"💛",yen:"💴",yin_yang:"☯️",yum:"😋",zap:"⚡️",zipper_mouth_face:"🤐",zzz:"💤",octocat:'<img alt=":octocat:" height="20" width="20" align="absmiddle" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png">',showdown:`<span style="font-family: 'Anonymous Pro', monospace; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #3e8b8a;text-underline-position: under;">S</span>`},r.Converter=function(e){var a={},t=[],n=[],s={},c=_,o={parsed:{},raw:"",format:""};l();function l(){e=e||{};for(var u in v)v.hasOwnProperty(u)&&(a[u]=v[u]);if(typeof e=="object")for(var m in e)e.hasOwnProperty(m)&&(a[m]=e[m]);else throw Error("Converter expects the passed parameter to be an object, but "+typeof e+" was passed instead.");a.extensions&&r.helper.forEach(a.extensions,y)}function y(u,m){if(m=m||null,r.helper.isString(u))if(u=r.helper.stdExtName(u),m=u,r.extensions[u]){console.warn("DEPRECATION WARNING: "+u+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),b(r.extensions[u],u);return}else if(!r.helper.isUndefined(h[u]))u=h[u];else throw Error('Extension "'+u+'" could not be loaded. It was either not found or is not a valid extension.');typeof u=="function"&&(u=u()),r.helper.isArray(u)||(u=[u]);var L=E(u,m);if(!L.valid)throw Error(L.error);for(var z=0;z<u.length;++z){switch(u[z].type){case"lang":t.push(u[z]);break;case"output":n.push(u[z]);break}if(u[z].hasOwnProperty("listeners"))for(var B in u[z].listeners)u[z].listeners.hasOwnProperty(B)&&p(B,u[z].listeners[B])}}function b(u,m){typeof u=="function"&&(u=u(new r.Converter)),r.helper.isArray(u)||(u=[u]);var L=E(u,m);if(!L.valid)throw Error(L.error);for(var z=0;z<u.length;++z)switch(u[z].type){case"lang":t.push(u[z]);break;case"output":n.push(u[z]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}function p(u,m){if(!r.helper.isString(u))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof u+" given");if(typeof m!="function")throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof m+" given");s.hasOwnProperty(u)||(s[u]=[]),s[u].push(m)}function w(u){var m=u.match(/^\s*/)[0].length,L=new RegExp("^\\s{0,"+m+"}","gm");return u.replace(L,"")}this._dispatch=function(m,L,z,B){if(s.hasOwnProperty(m))for(var V=0;V<s[m].length;++V){var W=s[m][V](m,L,this,z,B);W&&typeof W<"u"&&(L=W)}return L},this.listen=function(u,m){return p(u,m),this},this.makeHtml=function(u){if(!u)return u;var m={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:t,outputModifiers:n,converter:this,ghCodeBlocks:[],metadata:{parsed:{},raw:"",format:""}};return u=u.replace(/¨/g,"¨T"),u=u.replace(/\$/g,"¨D"),u=u.replace(/\r\n/g,`
`),u=u.replace(/\r/g,`
`),u=u.replace(/\u00A0/g,"&nbsp;"),a.smartIndentationFix&&(u=w(u)),u=`

`+u+`

`,u=r.subParser("detab")(u,a,m),u=u.replace(/^[ \t]+$/mg,""),r.helper.forEach(t,function(L){u=r.subParser("runExtension")(L,u,a,m)}),u=r.subParser("metadata")(u,a,m),u=r.subParser("hashPreCodeTags")(u,a,m),u=r.subParser("githubCodeBlocks")(u,a,m),u=r.subParser("hashHTMLBlocks")(u,a,m),u=r.subParser("hashCodeTags")(u,a,m),u=r.subParser("stripLinkDefinitions")(u,a,m),u=r.subParser("blockGamut")(u,a,m),u=r.subParser("unhashHTMLSpans")(u,a,m),u=r.subParser("unescapeSpecialChars")(u,a,m),u=u.replace(/¨D/g,"$$"),u=u.replace(/¨T/g,"¨"),u=r.subParser("completeHTMLDocument")(u,a,m),r.helper.forEach(n,function(L){u=r.subParser("runExtension")(L,u,a,m)}),o=m.metadata,u},this.makeMarkdown=this.makeMd=function(u,m){if(u=u.replace(/\r\n/g,`
`),u=u.replace(/\r/g,`
`),u=u.replace(/>[ \t]+</,">¨NBSP;<"),!m)if(window&&window.document)m=window.document;else throw new Error("HTMLParser is undefined. If in a webworker or nodejs environment, you need to provide a WHATWG DOM and HTML such as JSDOM");var L=m.createElement("div");L.innerHTML=u;var z={preList:K(L)};G(L);for(var B=L.childNodes,V="",W=0;W<B.length;W++)V+=r.subParser("makeMarkdown.node")(B[W],z);function G(q){for(var x=0;x<q.childNodes.length;++x){var Z=q.childNodes[x];Z.nodeType===3?!/\S/.test(Z.nodeValue)&&!/^[ ]+$/.test(Z.nodeValue)?(q.removeChild(Z),--x):(Z.nodeValue=Z.nodeValue.split(`
`).join(" "),Z.nodeValue=Z.nodeValue.replace(/(\s)+/g,"$1")):Z.nodeType===1&&G(Z)}}function K(q){for(var x=q.querySelectorAll("pre"),Z=[],J=0;J<x.length;++J)if(x[J].childElementCount===1&&x[J].firstChild.tagName.toLowerCase()==="code"){var fe=x[J].firstChild.innerHTML.trim(),he=x[J].firstChild.getAttribute("data-language")||"";if(he==="")for(var ze=x[J].firstChild.className.split(" "),pe=0;pe<ze.length;++pe){var Te=ze[pe].match(/^language-(.+)$/);if(Te!==null){he=Te[1];break}}fe=r.helper.unescapeHTMLEntities(fe),Z.push(fe),x[J].outerHTML='<precode language="'+he+'" precodenum="'+J.toString()+'"></precode>'}else Z.push(x[J].innerHTML),x[J].innerHTML="",x[J].setAttribute("prenum",J.toString());return Z}return V},this.setOption=function(u,m){a[u]=m},this.getOption=function(u){return a[u]},this.getOptions=function(){return a},this.addExtension=function(u,m){m=m||null,y(u,m)},this.useExtension=function(u){y(u)},this.setFlavor=function(u){if(!g.hasOwnProperty(u))throw Error(u+" flavor was not found");var m=g[u];c=u;for(var L in m)m.hasOwnProperty(L)&&(a[L]=m[L])},this.getFlavor=function(){return c},this.removeExtension=function(u){r.helper.isArray(u)||(u=[u]);for(var m=0;m<u.length;++m){for(var L=u[m],z=0;z<t.length;++z)t[z]===L&&t.splice(z,1);for(var B=0;B<n.length;++B)n[B]===L&&n.splice(B,1)}},this.getAllExtensions=function(){return{language:t,output:n}},this.getMetadata=function(u){return u?o.raw:o.parsed},this.getMetadataFormat=function(){return o.format},this._setMetadataPair=function(u,m){o.parsed[u]=m},this._setMetadataFormat=function(u){o.format=u},this._setMetadataRaw=function(u){o.raw=u}},r.subParser("anchors",function(e,a,t){e=t.converter._dispatch("anchors.before",e,a,t);var n=function(s,c,o,l,y,b,p){if(r.helper.isUndefined(p)&&(p=""),o=o.toLowerCase(),s.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)l="";else if(!l)if(o||(o=c.toLowerCase().replace(/ ?\n/g," ")),l="#"+o,!r.helper.isUndefined(t.gUrls[o]))l=t.gUrls[o],r.helper.isUndefined(t.gTitles[o])||(p=t.gTitles[o]);else return s;l=l.replace(r.helper.regexes.asteriskDashAndColon,r.helper.escapeCharactersCallback);var w='<a href="'+l+'"';return p!==""&&p!==null&&(p=p.replace(/"/g,"&quot;"),p=p.replace(r.helper.regexes.asteriskDashAndColon,r.helper.escapeCharactersCallback),w+=' title="'+p+'"'),a.openLinksInNewWindow&&!/^#/.test(l)&&(w+=' rel="noopener noreferrer" target="¨E95Eblank"'),w+=">"+c+"</a>",w};return e=e.replace(/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]()()()()/g,n),e=e.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,n),e=e.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,n),e=e.replace(/\[([^\[\]]+)]()()()()()/g,n),a.ghMentions&&(e=e.replace(/(^|\s)(\\)?(@([a-z\d]+(?:[a-z\d.-]+?[a-z\d]+)*))/gmi,function(s,c,o,l,y){if(o==="\\")return c+l;if(!r.helper.isString(a.ghMentionsLink))throw new Error("ghMentionsLink option must be a string");var b=a.ghMentionsLink.replace(/\{u}/g,y),p="";return a.openLinksInNewWindow&&(p=' rel="noopener noreferrer" target="¨E95Eblank"'),c+'<a href="'+b+'"'+p+">"+l+"</a>"})),e=t.converter._dispatch("anchors.after",e,a,t),e});var A=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+?\.[^'">\s]+?)()(\1)?(?=\s|$)(?!["<>])/gi,k=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+?)([.!?,()\[\]])?(\1)?(?=\s|$)(?!["<>])/gi,P=/()<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)()>()/gi,I=/(^|\s)(?:mailto:)?([A-Za-z0-9!#$%&'*+-/=?^_`{|}~.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?=$|\s)/gmi,D=/<()(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,R=function(e){return function(a,t,n,s,c,o,l){n=n.replace(r.helper.regexes.asteriskDashAndColon,r.helper.escapeCharactersCallback);var y=n,b="",p="",w=t||"",u=l||"";return/^www\./i.test(n)&&(n=n.replace(/^www\./i,"http://www.")),e.excludeTrailingPunctuationFromURLs&&o&&(b=o),e.openLinksInNewWindow&&(p=' rel="noopener noreferrer" target="¨E95Eblank"'),w+'<a href="'+n+'"'+p+">"+y+"</a>"+b+u}},H=function(e,a){return function(t,n,s){var c="mailto:";return n=n||"",s=r.subParser("unescapeSpecialChars")(s,e,a),e.encodeEmails?(c=r.helper.encodeEmailAddress(c+s),s=r.helper.encodeEmailAddress(s)):c=c+s,n+'<a href="'+c+'">'+s+"</a>"}};r.subParser("autoLinks",function(e,a,t){return e=t.converter._dispatch("autoLinks.before",e,a,t),e=e.replace(P,R(a)),e=e.replace(D,H(a,t)),e=t.converter._dispatch("autoLinks.after",e,a,t),e}),r.subParser("simplifiedAutoLinks",function(e,a,t){return a.simplifiedAutoLink&&(e=t.converter._dispatch("simplifiedAutoLinks.before",e,a,t),a.excludeTrailingPunctuationFromURLs?e=e.replace(k,R(a)):e=e.replace(A,R(a)),e=e.replace(I,H(a,t)),e=t.converter._dispatch("simplifiedAutoLinks.after",e,a,t)),e}),r.subParser("blockGamut",function(e,a,t){return e=t.converter._dispatch("blockGamut.before",e,a,t),e=r.subParser("blockQuotes")(e,a,t),e=r.subParser("headers")(e,a,t),e=r.subParser("horizontalRule")(e,a,t),e=r.subParser("lists")(e,a,t),e=r.subParser("codeBlocks")(e,a,t),e=r.subParser("tables")(e,a,t),e=r.subParser("hashHTMLBlocks")(e,a,t),e=r.subParser("paragraphs")(e,a,t),e=t.converter._dispatch("blockGamut.after",e,a,t),e}),r.subParser("blockQuotes",function(e,a,t){e=t.converter._dispatch("blockQuotes.before",e,a,t),e=e+`

`;var n=/(^ {0,3}>[ \t]?.+\n(.+\n)*\n*)+/gm;return a.splitAdjacentBlockquotes&&(n=/^ {0,3}>[\s\S]*?(?:\n\n)/gm),e=e.replace(n,function(s){return s=s.replace(/^[ \t]*>[ \t]?/gm,""),s=s.replace(/¨0/g,""),s=s.replace(/^[ \t]+$/gm,""),s=r.subParser("githubCodeBlocks")(s,a,t),s=r.subParser("blockGamut")(s,a,t),s=s.replace(/(^|\n)/g,"$1  "),s=s.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(c,o){var l=o;return l=l.replace(/^  /mg,"¨0"),l=l.replace(/¨0/g,""),l}),r.subParser("hashBlock")(`<blockquote>
`+s+`
</blockquote>`,a,t)}),e=t.converter._dispatch("blockQuotes.after",e,a,t),e}),r.subParser("codeBlocks",function(e,a,t){e=t.converter._dispatch("codeBlocks.before",e,a,t),e+="¨0";var n=/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=¨0))/g;return e=e.replace(n,function(s,c,o){var l=c,y=o,b=`
`;return l=r.subParser("outdent")(l,a,t),l=r.subParser("encodeCode")(l,a,t),l=r.subParser("detab")(l,a,t),l=l.replace(/^\n+/g,""),l=l.replace(/\n+$/g,""),a.omitExtraWLInCodeBlocks&&(b=""),l="<pre><code>"+l+b+"</code></pre>",r.subParser("hashBlock")(l,a,t)+y}),e=e.replace(/¨0/,""),e=t.converter._dispatch("codeBlocks.after",e,a,t),e}),r.subParser("codeSpans",function(e,a,t){return e=t.converter._dispatch("codeSpans.before",e,a,t),typeof e>"u"&&(e=""),e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(n,s,c,o){var l=o;return l=l.replace(/^([ \t]*)/g,""),l=l.replace(/[ \t]*$/g,""),l=r.subParser("encodeCode")(l,a,t),l=s+"<code>"+l+"</code>",l=r.subParser("hashHTMLSpans")(l,a,t),l}),e=t.converter._dispatch("codeSpans.after",e,a,t),e}),r.subParser("completeHTMLDocument",function(e,a,t){if(!a.completeHTMLDocument)return e;e=t.converter._dispatch("completeHTMLDocument.before",e,a,t);var n="html",s=`<!DOCTYPE HTML>
`,c="",o=`<meta charset="utf-8">
`,l="",y="";typeof t.metadata.parsed.doctype<"u"&&(s="<!DOCTYPE "+t.metadata.parsed.doctype+`>
`,n=t.metadata.parsed.doctype.toString().toLowerCase(),(n==="html"||n==="html5")&&(o='<meta charset="utf-8">'));for(var b in t.metadata.parsed)if(t.metadata.parsed.hasOwnProperty(b))switch(b.toLowerCase()){case"doctype":break;case"title":c="<title>"+t.metadata.parsed.title+`</title>
`;break;case"charset":n==="html"||n==="html5"?o='<meta charset="'+t.metadata.parsed.charset+`">
`:o='<meta name="charset" content="'+t.metadata.parsed.charset+`">
`;break;case"language":case"lang":l=' lang="'+t.metadata.parsed[b]+'"',y+='<meta name="'+b+'" content="'+t.metadata.parsed[b]+`">
`;break;default:y+='<meta name="'+b+'" content="'+t.metadata.parsed[b]+`">
`}return e=s+"<html"+l+`>
<head>
`+c+o+y+`</head>
<body>
`+e.trim()+`
</body>
</html>`,e=t.converter._dispatch("completeHTMLDocument.after",e,a,t),e}),r.subParser("detab",function(e,a,t){return e=t.converter._dispatch("detab.before",e,a,t),e=e.replace(/\t(?=\t)/g,"    "),e=e.replace(/\t/g,"¨A¨B"),e=e.replace(/¨B(.+?)¨A/g,function(n,s){for(var c=s,o=4-c.length%4,l=0;l<o;l++)c+=" ";return c}),e=e.replace(/¨A/g,"    "),e=e.replace(/¨B/g,""),e=t.converter._dispatch("detab.after",e,a,t),e}),r.subParser("ellipsis",function(e,a,t){return a.ellipsis&&(e=t.converter._dispatch("ellipsis.before",e,a,t),e=e.replace(/\.\.\./g,"…"),e=t.converter._dispatch("ellipsis.after",e,a,t)),e}),r.subParser("emoji",function(e,a,t){if(!a.emoji)return e;e=t.converter._dispatch("emoji.before",e,a,t);var n=/:([\S]+?):/g;return e=e.replace(n,function(s,c){return r.helper.emojis.hasOwnProperty(c)?r.helper.emojis[c]:s}),e=t.converter._dispatch("emoji.after",e,a,t),e}),r.subParser("encodeAmpsAndAngles",function(e,a,t){return e=t.converter._dispatch("encodeAmpsAndAngles.before",e,a,t),e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),e=e.replace(/<(?![a-z\/?$!])/gi,"&lt;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=t.converter._dispatch("encodeAmpsAndAngles.after",e,a,t),e}),r.subParser("encodeBackslashEscapes",function(e,a,t){return e=t.converter._dispatch("encodeBackslashEscapes.before",e,a,t),e=e.replace(/\\(\\)/g,r.helper.escapeCharactersCallback),e=e.replace(/\\([`*_{}\[\]()>#+.!~=|:-])/g,r.helper.escapeCharactersCallback),e=t.converter._dispatch("encodeBackslashEscapes.after",e,a,t),e}),r.subParser("encodeCode",function(e,a,t){return e=t.converter._dispatch("encodeCode.before",e,a,t),e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([*_{}\[\]\\=~-])/g,r.helper.escapeCharactersCallback),e=t.converter._dispatch("encodeCode.after",e,a,t),e}),r.subParser("escapeSpecialCharsWithinTagAttributes",function(e,a,t){e=t.converter._dispatch("escapeSpecialCharsWithinTagAttributes.before",e,a,t);var n=/<\/?[a-z\d_:-]+(?:[\s]+[\s\S]+?)?>/gi,s=/<!(--(?:(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>/gi;return e=e.replace(n,function(c){return c.replace(/(.)<\/?code>(?=.)/g,"$1`").replace(/([\\`*_~=|])/g,r.helper.escapeCharactersCallback)}),e=e.replace(s,function(c){return c.replace(/([\\`*_~=|])/g,r.helper.escapeCharactersCallback)}),e=t.converter._dispatch("escapeSpecialCharsWithinTagAttributes.after",e,a,t),e}),r.subParser("githubCodeBlocks",function(e,a,t){return a.ghCodeBlocks?(e=t.converter._dispatch("githubCodeBlocks.before",e,a,t),e+="¨0",e=e.replace(/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/g,function(n,s,c,o){var l=a.omitExtraWLInCodeBlocks?"":`
`;return o=r.subParser("encodeCode")(o,a,t),o=r.subParser("detab")(o,a,t),o=o.replace(/^\n+/g,""),o=o.replace(/\n+$/g,""),o="<pre><code"+(c?' class="'+c+" language-"+c+'"':"")+">"+o+l+"</code></pre>",o=r.subParser("hashBlock")(o,a,t),`

¨G`+(t.ghCodeBlocks.push({text:n,codeblock:o})-1)+`G

`}),e=e.replace(/¨0/,""),t.converter._dispatch("githubCodeBlocks.after",e,a,t)):e}),r.subParser("hashBlock",function(e,a,t){return e=t.converter._dispatch("hashBlock.before",e,a,t),e=e.replace(/(^\n+|\n+$)/g,""),e=`

¨K`+(t.gHtmlBlocks.push(e)-1)+`K

`,e=t.converter._dispatch("hashBlock.after",e,a,t),e}),r.subParser("hashCodeTags",function(e,a,t){e=t.converter._dispatch("hashCodeTags.before",e,a,t);var n=function(s,c,o,l){var y=o+r.subParser("encodeCode")(c,a,t)+l;return"¨C"+(t.gHtmlSpans.push(y)-1)+"C"};return e=r.helper.replaceRecursiveRegExp(e,n,"<code\\b[^>]*>","</code>","gim"),e=t.converter._dispatch("hashCodeTags.after",e,a,t),e}),r.subParser("hashElement",function(e,a,t){return function(n,s){var c=s;return c=c.replace(/\n\n/g,`
`),c=c.replace(/^\n/,""),c=c.replace(/\n+$/g,""),c=`

¨K`+(t.gHtmlBlocks.push(c)-1)+`K

`,c}}),r.subParser("hashHTMLBlocks",function(e,a,t){e=t.converter._dispatch("hashHTMLBlocks.before",e,a,t);var n=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],s=function(u,m,L,z){var B=u;return L.search(/\bmarkdown\b/)!==-1&&(B=L+t.converter.makeHtml(m)+z),`

¨K`+(t.gHtmlBlocks.push(B)-1)+`K

`};a.backslashEscapesHTMLTags&&(e=e.replace(/\\<(\/?[^>]+?)>/g,function(u,m){return"&lt;"+m+"&gt;"}));for(var c=0;c<n.length;++c)for(var o,l=new RegExp("^ {0,3}(<"+n[c]+"\\b[^>]*>)","im"),y="<"+n[c]+"\\b[^>]*>",b="</"+n[c]+">";(o=r.helper.regexIndexOf(e,l))!==-1;){var p=r.helper.splitAtIndex(e,o),w=r.helper.replaceRecursiveRegExp(p[1],s,y,b,"im");if(w===p[1])break;e=p[0].concat(w)}return e=e.replace(/(\n {0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,r.subParser("hashElement")(e,a,t)),e=r.helper.replaceRecursiveRegExp(e,function(u){return`

¨K`+(t.gHtmlBlocks.push(u)-1)+`K

`},"^ {0,3}<!--","-->","gm"),e=e.replace(/(?:\n\n)( {0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,r.subParser("hashElement")(e,a,t)),e=t.converter._dispatch("hashHTMLBlocks.after",e,a,t),e}),r.subParser("hashHTMLSpans",function(e,a,t){e=t.converter._dispatch("hashHTMLSpans.before",e,a,t);function n(s){return"¨C"+(t.gHtmlSpans.push(s)-1)+"C"}return e=e.replace(/<[^>]+?\/>/gi,function(s){return n(s)}),e=e.replace(/<([^>]+?)>[\s\S]*?<\/\1>/g,function(s){return n(s)}),e=e.replace(/<([^>]+?)\s[^>]+?>[\s\S]*?<\/\1>/g,function(s){return n(s)}),e=e.replace(/<[^>]+?>/gi,function(s){return n(s)}),e=t.converter._dispatch("hashHTMLSpans.after",e,a,t),e}),r.subParser("unhashHTMLSpans",function(e,a,t){e=t.converter._dispatch("unhashHTMLSpans.before",e,a,t);for(var n=0;n<t.gHtmlSpans.length;++n){for(var s=t.gHtmlSpans[n],c=0;/¨C(\d+)C/.test(s);){var o=RegExp.$1;if(s=s.replace("¨C"+o+"C",t.gHtmlSpans[o]),c===10){console.error("maximum nesting of 10 spans reached!!!");break}++c}e=e.replace("¨C"+n+"C",s)}return e=t.converter._dispatch("unhashHTMLSpans.after",e,a,t),e}),r.subParser("hashPreCodeTags",function(e,a,t){e=t.converter._dispatch("hashPreCodeTags.before",e,a,t);var n=function(s,c,o,l){var y=o+r.subParser("encodeCode")(c,a,t)+l;return`

¨G`+(t.ghCodeBlocks.push({text:s,codeblock:y})-1)+`G

`};return e=r.helper.replaceRecursiveRegExp(e,n,"^ {0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^ {0,3}</code>\\s*</pre>","gim"),e=t.converter._dispatch("hashPreCodeTags.after",e,a,t),e}),r.subParser("headers",function(e,a,t){e=t.converter._dispatch("headers.before",e,a,t);var n=isNaN(parseInt(a.headerLevelStart))?1:parseInt(a.headerLevelStart),s=a.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,c=a.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;e=e.replace(s,function(y,b){var p=r.subParser("spanGamut")(b,a,t),w=a.noHeaderId?"":' id="'+l(b)+'"',u=n,m="<h"+u+w+">"+p+"</h"+u+">";return r.subParser("hashBlock")(m,a,t)}),e=e.replace(c,function(y,b){var p=r.subParser("spanGamut")(b,a,t),w=a.noHeaderId?"":' id="'+l(b)+'"',u=n+1,m="<h"+u+w+">"+p+"</h"+u+">";return r.subParser("hashBlock")(m,a,t)});var o=a.requireSpaceBeforeHeadingText?/^(#{1,6})[ \t]+(.+?)[ \t]*#*\n+/gm:/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm;e=e.replace(o,function(y,b,p){var w=p;a.customizedHeaderId&&(w=p.replace(/\s?\{([^{]+?)}\s*$/,""));var u=r.subParser("spanGamut")(w,a,t),m=a.noHeaderId?"":' id="'+l(p)+'"',L=n-1+b.length,z="<h"+L+m+">"+u+"</h"+L+">";return r.subParser("hashBlock")(z,a,t)});function l(y){var b,p;if(a.customizedHeaderId){var w=y.match(/\{([^{]+?)}\s*$/);w&&w[1]&&(y=w[1])}return b=y,r.helper.isString(a.prefixHeaderId)?p=a.prefixHeaderId:a.prefixHeaderId===!0?p="section-":p="",a.rawPrefixHeaderId||(b=p+b),a.ghCompatibleHeaderId?b=b.replace(/ /g,"-").replace(/&amp;/g,"").replace(/¨T/g,"").replace(/¨D/g,"").replace(/[&+$,\/:;=?@"#{}|^¨~\[\]`\\*)(%.!'<>]/g,"").toLowerCase():a.rawHeaderId?b=b.replace(/ /g,"-").replace(/&amp;/g,"&").replace(/¨T/g,"¨").replace(/¨D/g,"$").replace(/["']/g,"-").toLowerCase():b=b.replace(/[^\w]/g,"").toLowerCase(),a.rawPrefixHeaderId&&(b=p+b),t.hashLinkCounts[b]?b=b+"-"+t.hashLinkCounts[b]++:t.hashLinkCounts[b]=1,b}return e=t.converter._dispatch("headers.after",e,a,t),e}),r.subParser("horizontalRule",function(e,a,t){e=t.converter._dispatch("horizontalRule.before",e,a,t);var n=r.subParser("hashBlock")("<hr />",a,t);return e=e.replace(/^ {0,2}( ?-){3,}[ \t]*$/gm,n),e=e.replace(/^ {0,2}( ?\*){3,}[ \t]*$/gm,n),e=e.replace(/^ {0,2}( ?_){3,}[ \t]*$/gm,n),e=t.converter._dispatch("horizontalRule.after",e,a,t),e}),r.subParser("images",function(e,a,t){e=t.converter._dispatch("images.before",e,a,t);var n=/!\[([^\]]*?)][ \t]*()\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,s=/!\[([^\]]*?)][ \t]*()\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/g,c=/!\[([^\]]*?)][ \t]*()\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,o=/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]()()()()()/g,l=/!\[([^\[\]]+)]()()()()()/g;function y(p,w,u,m,L,z,B,V){return m=m.replace(/\s/g,""),b(p,w,u,m,L,z,B,V)}function b(p,w,u,m,L,z,B,V){var W=t.gUrls,G=t.gTitles,K=t.gDimensions;if(u=u.toLowerCase(),V||(V=""),p.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)m="";else if(m===""||m===null)if((u===""||u===null)&&(u=w.toLowerCase().replace(/ ?\n/g," ")),m="#"+u,!r.helper.isUndefined(W[u]))m=W[u],r.helper.isUndefined(G[u])||(V=G[u]),r.helper.isUndefined(K[u])||(L=K[u].width,z=K[u].height);else return p;w=w.replace(/"/g,"&quot;").replace(r.helper.regexes.asteriskDashAndColon,r.helper.escapeCharactersCallback),m=m.replace(r.helper.regexes.asteriskDashAndColon,r.helper.escapeCharactersCallback);var q='<img src="'+m+'" alt="'+w+'"';return V&&r.helper.isString(V)&&(V=V.replace(/"/g,"&quot;").replace(r.helper.regexes.asteriskDashAndColon,r.helper.escapeCharactersCallback),q+=' title="'+V+'"'),L&&z&&(L=L==="*"?"auto":L,z=z==="*"?"auto":z,q+=' width="'+L+'"',q+=' height="'+z+'"'),q+=" />",q}return e=e.replace(o,b),e=e.replace(c,y),e=e.replace(s,b),e=e.replace(n,b),e=e.replace(l,b),e=t.converter._dispatch("images.after",e,a,t),e}),r.subParser("italicsAndBold",function(e,a,t){e=t.converter._dispatch("italicsAndBold.before",e,a,t);function n(s,c,o){return c+s+o}return a.literalMidWordUnderscores?(e=e.replace(/\b___(\S[\s\S]*?)___\b/g,function(s,c){return n(c,"<strong><em>","</em></strong>")}),e=e.replace(/\b__(\S[\s\S]*?)__\b/g,function(s,c){return n(c,"<strong>","</strong>")}),e=e.replace(/\b_(\S[\s\S]*?)_\b/g,function(s,c){return n(c,"<em>","</em>")})):(e=e.replace(/___(\S[\s\S]*?)___/g,function(s,c){return/\S$/.test(c)?n(c,"<strong><em>","</em></strong>"):s}),e=e.replace(/__(\S[\s\S]*?)__/g,function(s,c){return/\S$/.test(c)?n(c,"<strong>","</strong>"):s}),e=e.replace(/_([^\s_][\s\S]*?)_/g,function(s,c){return/\S$/.test(c)?n(c,"<em>","</em>"):s})),a.literalMidWordAsterisks?(e=e.replace(/([^*]|^)\B\*\*\*(\S[\s\S]*?)\*\*\*\B(?!\*)/g,function(s,c,o){return n(o,c+"<strong><em>","</em></strong>")}),e=e.replace(/([^*]|^)\B\*\*(\S[\s\S]*?)\*\*\B(?!\*)/g,function(s,c,o){return n(o,c+"<strong>","</strong>")}),e=e.replace(/([^*]|^)\B\*(\S[\s\S]*?)\*\B(?!\*)/g,function(s,c,o){return n(o,c+"<em>","</em>")})):(e=e.replace(/\*\*\*(\S[\s\S]*?)\*\*\*/g,function(s,c){return/\S$/.test(c)?n(c,"<strong><em>","</em></strong>"):s}),e=e.replace(/\*\*(\S[\s\S]*?)\*\*/g,function(s,c){return/\S$/.test(c)?n(c,"<strong>","</strong>"):s}),e=e.replace(/\*([^\s*][\s\S]*?)\*/g,function(s,c){return/\S$/.test(c)?n(c,"<em>","</em>"):s})),e=t.converter._dispatch("italicsAndBold.after",e,a,t),e}),r.subParser("lists",function(e,a,t){function n(o,l){t.gListLevel++,o=o.replace(/\n{2,}$/,`
`),o+="¨0";var y=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0| {0,3}([*+-]|\d+[.])[ \t]+))/gm,b=/\n[ \t]*\n(?!¨0)/.test(o);return a.disableForced4SpacesIndentedSublists&&(y=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0|\2([*+-]|\d+[.])[ \t]+))/gm),o=o.replace(y,function(p,w,u,m,L,z,B){B=B&&B.trim()!=="";var V=r.subParser("outdent")(L,a,t),W="";return z&&a.tasklists&&(W=' class="task-list-item" style="list-style-type: none;"',V=V.replace(/^[ \t]*\[(x|X| )?]/m,function(){var G='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return B&&(G+=" checked"),G+=">",G})),V=V.replace(/^([-*+]|\d\.)[ \t]+[\S\n ]*/g,function(G){return"¨A"+G}),w||V.search(/\n{2,}/)>-1?(V=r.subParser("githubCodeBlocks")(V,a,t),V=r.subParser("blockGamut")(V,a,t)):(V=r.subParser("lists")(V,a,t),V=V.replace(/\n$/,""),V=r.subParser("hashHTMLBlocks")(V,a,t),V=V.replace(/\n\n+/g,`

`),b?V=r.subParser("paragraphs")(V,a,t):V=r.subParser("spanGamut")(V,a,t)),V=V.replace("¨A",""),V="<li"+W+">"+V+`</li>
`,V}),o=o.replace(/¨0/g,""),t.gListLevel--,l&&(o=o.replace(/\s+$/,"")),o}function s(o,l){if(l==="ol"){var y=o.match(/^ *(\d+)\./);if(y&&y[1]!=="1")return' start="'+y[1]+'"'}return""}function c(o,l,y){var b=a.disableForced4SpacesIndentedSublists?/^ ?\d+\.[ \t]/gm:/^ {0,3}\d+\.[ \t]/gm,p=a.disableForced4SpacesIndentedSublists?/^ ?[*+-][ \t]/gm:/^ {0,3}[*+-][ \t]/gm,w=l==="ul"?b:p,u="";if(o.search(w)!==-1)(function L(z){var B=z.search(w),V=s(o,l);B!==-1?(u+=`

<`+l+V+`>
`+n(z.slice(0,B),!!y)+"</"+l+`>
`,l=l==="ul"?"ol":"ul",w=l==="ul"?b:p,L(z.slice(B))):u+=`

<`+l+V+`>
`+n(z,!!y)+"</"+l+`>
`})(o);else{var m=s(o,l);u=`

<`+l+m+`>
`+n(o,!!y)+"</"+l+`>
`}return u}return e=t.converter._dispatch("lists.before",e,a,t),e+="¨0",t.gListLevel?e=e.replace(/^(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(o,l,y){var b=y.search(/[*+-]/g)>-1?"ul":"ol";return c(l,b,!0)}):e=e.replace(/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(o,l,y,b){var p=b.search(/[*+-]/g)>-1?"ul":"ol";return c(y,p,!1)}),e=e.replace(/¨0/,""),e=t.converter._dispatch("lists.after",e,a,t),e}),r.subParser("metadata",function(e,a,t){if(!a.metadata)return e;e=t.converter._dispatch("metadata.before",e,a,t);function n(s){t.metadata.raw=s,s=s.replace(/&/g,"&amp;").replace(/"/g,"&quot;"),s=s.replace(/\n {4}/g," "),s.replace(/^([\S ]+): +([\s\S]+?)$/gm,function(c,o,l){return t.metadata.parsed[o]=l,""})}return e=e.replace(/^\s*«««+(\S*?)\n([\s\S]+?)\n»»»+\n/,function(s,c,o){return n(o),"¨M"}),e=e.replace(/^\s*---+(\S*?)\n([\s\S]+?)\n---+\n/,function(s,c,o){return c&&(t.metadata.format=c),n(o),"¨M"}),e=e.replace(/¨M/g,""),e=t.converter._dispatch("metadata.after",e,a,t),e}),r.subParser("outdent",function(e,a,t){return e=t.converter._dispatch("outdent.before",e,a,t),e=e.replace(/^(\t|[ ]{1,4})/gm,"¨0"),e=e.replace(/¨0/g,""),e=t.converter._dispatch("outdent.after",e,a,t),e}),r.subParser("paragraphs",function(e,a,t){e=t.converter._dispatch("paragraphs.before",e,a,t),e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");for(var n=e.split(/\n{2,}/g),s=[],c=n.length,o=0;o<c;o++){var l=n[o];l.search(/¨(K|G)(\d+)\1/g)>=0?s.push(l):l.search(/\S/)>=0&&(l=r.subParser("spanGamut")(l,a,t),l=l.replace(/^([ \t]*)/g,"<p>"),l+="</p>",s.push(l))}for(c=s.length,o=0;o<c;o++){for(var y="",b=s[o],p=!1;/¨(K|G)(\d+)\1/.test(b);){var w=RegExp.$1,u=RegExp.$2;w==="K"?y=t.gHtmlBlocks[u]:p?y=r.subParser("encodeCode")(t.ghCodeBlocks[u].text,a,t):y=t.ghCodeBlocks[u].codeblock,y=y.replace(/\$/g,"$$$$"),b=b.replace(/(\n\n)?¨(K|G)\d+\2(\n\n)?/,y),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(b)&&(p=!0)}s[o]=b}return e=s.join(`
`),e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,""),t.converter._dispatch("paragraphs.after",e,a,t)}),r.subParser("runExtension",function(e,a,t,n){if(e.filter)a=e.filter(a,n.converter,t);else if(e.regex){var s=e.regex;s instanceof RegExp||(s=new RegExp(s,"g")),a=a.replace(s,e.replace)}return a}),r.subParser("spanGamut",function(e,a,t){return e=t.converter._dispatch("spanGamut.before",e,a,t),e=r.subParser("codeSpans")(e,a,t),e=r.subParser("escapeSpecialCharsWithinTagAttributes")(e,a,t),e=r.subParser("encodeBackslashEscapes")(e,a,t),e=r.subParser("images")(e,a,t),e=r.subParser("anchors")(e,a,t),e=r.subParser("autoLinks")(e,a,t),e=r.subParser("simplifiedAutoLinks")(e,a,t),e=r.subParser("emoji")(e,a,t),e=r.subParser("underline")(e,a,t),e=r.subParser("italicsAndBold")(e,a,t),e=r.subParser("strikethrough")(e,a,t),e=r.subParser("ellipsis")(e,a,t),e=r.subParser("hashHTMLSpans")(e,a,t),e=r.subParser("encodeAmpsAndAngles")(e,a,t),a.simpleLineBreaks?/\n\n¨K/.test(e)||(e=e.replace(/\n+/g,`<br />
`)):e=e.replace(/  +\n/g,`<br />
`),e=t.converter._dispatch("spanGamut.after",e,a,t),e}),r.subParser("strikethrough",function(e,a,t){function n(s){return a.simplifiedAutoLink&&(s=r.subParser("simplifiedAutoLinks")(s,a,t)),"<del>"+s+"</del>"}return a.strikethrough&&(e=t.converter._dispatch("strikethrough.before",e,a,t),e=e.replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,function(s,c){return n(c)}),e=t.converter._dispatch("strikethrough.after",e,a,t)),e}),r.subParser("stripLinkDefinitions",function(e,a,t){var n=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?([^>\s]+)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=¨0))/gm,s=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n\n|(?=¨0)|(?=\n\[))/gm;e+="¨0";var c=function(o,l,y,b,p,w,u){return l=l.toLowerCase(),e.toLowerCase().split(l).length-1<2?o:(y.match(/^data:.+?\/.+?;base64,/)?t.gUrls[l]=y.replace(/\s/g,""):t.gUrls[l]=r.subParser("encodeAmpsAndAngles")(y,a,t),w?w+u:(u&&(t.gTitles[l]=u.replace(/"|'/g,"&quot;")),a.parseImgDimensions&&b&&p&&(t.gDimensions[l]={width:b,height:p}),""))};return e=e.replace(s,c),e=e.replace(n,c),e=e.replace(/¨0/,""),e}),r.subParser("tables",function(e,a,t){if(!a.tables)return e;var n=/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|¨0)/gm,s=/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|¨0)/gm;function c(p){return/^:[ \t]*--*$/.test(p)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(p)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(p)?' style="text-align:center;"':""}function o(p,w){var u="";return p=p.trim(),(a.tablesHeaderId||a.tableHeaderId)&&(u=' id="'+p.replace(/ /g,"_").toLowerCase()+'"'),p=r.subParser("spanGamut")(p,a,t),"<th"+u+w+">"+p+`</th>
`}function l(p,w){var u=r.subParser("spanGamut")(p,a,t);return"<td"+w+">"+u+`</td>
`}function y(p,w){for(var u=`<table>
<thead>
<tr>
`,m=p.length,L=0;L<m;++L)u+=p[L];for(u+=`</tr>
</thead>
<tbody>
`,L=0;L<w.length;++L){u+=`<tr>
`;for(var z=0;z<m;++z)u+=w[L][z];u+=`</tr>
`}return u+=`</tbody>
</table>
`,u}function b(p){var w,u=p.split(`
`);for(w=0;w<u.length;++w)/^ {0,3}\|/.test(u[w])&&(u[w]=u[w].replace(/^ {0,3}\|/,"")),/\|[ \t]*$/.test(u[w])&&(u[w]=u[w].replace(/\|[ \t]*$/,"")),u[w]=r.subParser("codeSpans")(u[w],a,t);var m=u[0].split("|").map(function(q){return q.trim()}),L=u[1].split("|").map(function(q){return q.trim()}),z=[],B=[],V=[],W=[];for(u.shift(),u.shift(),w=0;w<u.length;++w)u[w].trim()!==""&&z.push(u[w].split("|").map(function(q){return q.trim()}));if(m.length<L.length)return p;for(w=0;w<L.length;++w)V.push(c(L[w]));for(w=0;w<m.length;++w)r.helper.isUndefined(V[w])&&(V[w]=""),B.push(o(m[w],V[w]));for(w=0;w<z.length;++w){for(var G=[],K=0;K<B.length;++K)r.helper.isUndefined(z[w][K]),G.push(l(z[w][K],V[K]));W.push(G)}return y(B,W)}return e=t.converter._dispatch("tables.before",e,a,t),e=e.replace(/\\(\|)/g,r.helper.escapeCharactersCallback),e=e.replace(n,b),e=e.replace(s,b),e=t.converter._dispatch("tables.after",e,a,t),e}),r.subParser("underline",function(e,a,t){return a.underline&&(e=t.converter._dispatch("underline.before",e,a,t),a.literalMidWordUnderscores?(e=e.replace(/\b___(\S[\s\S]*?)___\b/g,function(n,s){return"<u>"+s+"</u>"}),e=e.replace(/\b__(\S[\s\S]*?)__\b/g,function(n,s){return"<u>"+s+"</u>"})):(e=e.replace(/___(\S[\s\S]*?)___/g,function(n,s){return/\S$/.test(s)?"<u>"+s+"</u>":n}),e=e.replace(/__(\S[\s\S]*?)__/g,function(n,s){return/\S$/.test(s)?"<u>"+s+"</u>":n})),e=e.replace(/(_)/g,r.helper.escapeCharactersCallback),e=t.converter._dispatch("underline.after",e,a,t)),e}),r.subParser("unescapeSpecialChars",function(e,a,t){return e=t.converter._dispatch("unescapeSpecialChars.before",e,a,t),e=e.replace(/¨E(\d+)E/g,function(n,s){var c=parseInt(s);return String.fromCharCode(c)}),e=t.converter._dispatch("unescapeSpecialChars.after",e,a,t),e}),r.subParser("makeMarkdown.blockquote",function(e,a){var t="";if(e.hasChildNodes())for(var n=e.childNodes,s=n.length,c=0;c<s;++c){var o=r.subParser("makeMarkdown.node")(n[c],a);o!==""&&(t+=o)}return t=t.trim(),t="> "+t.split(`
`).join(`
> `),t}),r.subParser("makeMarkdown.codeBlock",function(e,a){var t=e.getAttribute("language"),n=e.getAttribute("precodenum");return"```"+t+`
`+a.preList[n]+"\n```"}),r.subParser("makeMarkdown.codeSpan",function(e){return"`"+e.innerHTML+"`"}),r.subParser("makeMarkdown.emphasis",function(e,a){var t="";if(e.hasChildNodes()){t+="*";for(var n=e.childNodes,s=n.length,c=0;c<s;++c)t+=r.subParser("makeMarkdown.node")(n[c],a);t+="*"}return t}),r.subParser("makeMarkdown.header",function(e,a,t){var n=new Array(t+1).join("#"),s="";if(e.hasChildNodes()){s=n+" ";for(var c=e.childNodes,o=c.length,l=0;l<o;++l)s+=r.subParser("makeMarkdown.node")(c[l],a)}return s}),r.subParser("makeMarkdown.hr",function(){return"---"}),r.subParser("makeMarkdown.image",function(e){var a="";return e.hasAttribute("src")&&(a+="!["+e.getAttribute("alt")+"](",a+="<"+e.getAttribute("src")+">",e.hasAttribute("width")&&e.hasAttribute("height")&&(a+=" ="+e.getAttribute("width")+"x"+e.getAttribute("height")),e.hasAttribute("title")&&(a+=' "'+e.getAttribute("title")+'"'),a+=")"),a}),r.subParser("makeMarkdown.links",function(e,a){var t="";if(e.hasChildNodes()&&e.hasAttribute("href")){var n=e.childNodes,s=n.length;t="[";for(var c=0;c<s;++c)t+=r.subParser("makeMarkdown.node")(n[c],a);t+="](",t+="<"+e.getAttribute("href")+">",e.hasAttribute("title")&&(t+=' "'+e.getAttribute("title")+'"'),t+=")"}return t}),r.subParser("makeMarkdown.list",function(e,a,t){var n="";if(!e.hasChildNodes())return"";for(var s=e.childNodes,c=s.length,o=e.getAttribute("start")||1,l=0;l<c;++l)if(!(typeof s[l].tagName>"u"||s[l].tagName.toLowerCase()!=="li")){var y="";t==="ol"?y=o.toString()+". ":y="- ",n+=y+r.subParser("makeMarkdown.listItem")(s[l],a),++o}return n+=`
<!-- -->
`,n.trim()}),r.subParser("makeMarkdown.listItem",function(e,a){for(var t="",n=e.childNodes,s=n.length,c=0;c<s;++c)t+=r.subParser("makeMarkdown.node")(n[c],a);return/\n$/.test(t)?t=t.split(`
`).join(`
    `).replace(/^ {4}$/gm,"").replace(/\n\n+/g,`

`):t+=`
`,t}),r.subParser("makeMarkdown.node",function(e,a,t){t=t||!1;var n="";if(e.nodeType===3)return r.subParser("makeMarkdown.txt")(e,a);if(e.nodeType===8)return"<!--"+e.data+`-->

`;if(e.nodeType!==1)return"";var s=e.tagName.toLowerCase();switch(s){case"h1":t||(n=r.subParser("makeMarkdown.header")(e,a,1)+`

`);break;case"h2":t||(n=r.subParser("makeMarkdown.header")(e,a,2)+`

`);break;case"h3":t||(n=r.subParser("makeMarkdown.header")(e,a,3)+`

`);break;case"h4":t||(n=r.subParser("makeMarkdown.header")(e,a,4)+`

`);break;case"h5":t||(n=r.subParser("makeMarkdown.header")(e,a,5)+`

`);break;case"h6":t||(n=r.subParser("makeMarkdown.header")(e,a,6)+`

`);break;case"p":t||(n=r.subParser("makeMarkdown.paragraph")(e,a)+`

`);break;case"blockquote":t||(n=r.subParser("makeMarkdown.blockquote")(e,a)+`

`);break;case"hr":t||(n=r.subParser("makeMarkdown.hr")(e,a)+`

`);break;case"ol":t||(n=r.subParser("makeMarkdown.list")(e,a,"ol")+`

`);break;case"ul":t||(n=r.subParser("makeMarkdown.list")(e,a,"ul")+`

`);break;case"precode":t||(n=r.subParser("makeMarkdown.codeBlock")(e,a)+`

`);break;case"pre":t||(n=r.subParser("makeMarkdown.pre")(e,a)+`

`);break;case"table":t||(n=r.subParser("makeMarkdown.table")(e,a)+`

`);break;case"code":n=r.subParser("makeMarkdown.codeSpan")(e,a);break;case"em":case"i":n=r.subParser("makeMarkdown.emphasis")(e,a);break;case"strong":case"b":n=r.subParser("makeMarkdown.strong")(e,a);break;case"del":n=r.subParser("makeMarkdown.strikethrough")(e,a);break;case"a":n=r.subParser("makeMarkdown.links")(e,a);break;case"img":n=r.subParser("makeMarkdown.image")(e,a);break;default:n=e.outerHTML+`

`}return n}),r.subParser("makeMarkdown.paragraph",function(e,a){var t="";if(e.hasChildNodes())for(var n=e.childNodes,s=n.length,c=0;c<s;++c)t+=r.subParser("makeMarkdown.node")(n[c],a);return t=t.trim(),t}),r.subParser("makeMarkdown.pre",function(e,a){var t=e.getAttribute("prenum");return"<pre>"+a.preList[t]+"</pre>"}),r.subParser("makeMarkdown.strikethrough",function(e,a){var t="";if(e.hasChildNodes()){t+="~~";for(var n=e.childNodes,s=n.length,c=0;c<s;++c)t+=r.subParser("makeMarkdown.node")(n[c],a);t+="~~"}return t}),r.subParser("makeMarkdown.strong",function(e,a){var t="";if(e.hasChildNodes()){t+="**";for(var n=e.childNodes,s=n.length,c=0;c<s;++c)t+=r.subParser("makeMarkdown.node")(n[c],a);t+="**"}return t}),r.subParser("makeMarkdown.table",function(e,a){var t="",n=[[],[]],s=e.querySelectorAll("thead>tr>th"),c=e.querySelectorAll("tbody>tr"),o,l;for(o=0;o<s.length;++o){var y=r.subParser("makeMarkdown.tableCell")(s[o],a),b="---";if(s[o].hasAttribute("style")){var p=s[o].getAttribute("style").toLowerCase().replace(/\s/g,"");switch(p){case"text-align:left;":b=":---";break;case"text-align:right;":b="---:";break;case"text-align:center;":b=":---:";break}}n[0][o]=y.trim(),n[1][o]=b}for(o=0;o<c.length;++o){var w=n.push([])-1,u=c[o].getElementsByTagName("td");for(l=0;l<s.length;++l){var m=" ";typeof u[l]<"u"&&(m=r.subParser("makeMarkdown.tableCell")(u[l],a)),n[w].push(m)}}var L=3;for(o=0;o<n.length;++o)for(l=0;l<n[o].length;++l){var z=n[o][l].length;z>L&&(L=z)}for(o=0;o<n.length;++o){for(l=0;l<n[o].length;++l)o===1?n[o][l].slice(-1)===":"?n[o][l]=r.helper.padEnd(n[o][l].slice(-1),L-1,"-")+":":n[o][l]=r.helper.padEnd(n[o][l],L,"-"):n[o][l]=r.helper.padEnd(n[o][l],L);t+="| "+n[o].join(" | ")+` |
`}return t.trim()}),r.subParser("makeMarkdown.tableCell",function(e,a){var t="";if(!e.hasChildNodes())return"";for(var n=e.childNodes,s=n.length,c=0;c<s;++c)t+=r.subParser("makeMarkdown.node")(n[c],a,!0);return t.trim()}),r.subParser("makeMarkdown.txt",function(e){var a=e.nodeValue;return a=a.replace(/ +/g," "),a=a.replace(/¨NBSP;/g," "),a=r.helper.unescapeHTMLEntities(a),a=a.replace(/([*_~|`])/g,"\\$1"),a=a.replace(/^(\s*)>/g,"\\$1>"),a=a.replace(/^#/gm,"\\#"),a=a.replace(/^(\s*)([-=]{3,})(\s*)$/,"$1\\$2$3"),a=a.replace(/^( {0,3}\d+)\./gm,"$1\\."),a=a.replace(/^( {0,3})([+-])/gm,"$1\\$2"),a=a.replace(/]([\s]*)\(/g,"\\]$1\\("),a=a.replace(/^ {0,3}\[([\S \t]*?)]:/gm,"\\[$1]:"),a});var T=this;j.exports?j.exports=r:T.showdown=r}).call(Je)}(ee)),ee.exports}var Xe=Ke();const Qe=we(Xe);function Ee(j,d){const r=d.scrollHeight-d.clientHeight<=d.scrollTop+300,f=d.scrollTop,h=new Qe.Converter;h.setOption("openLinksInNewWindow",!0);const v=S=>{const M=S.type==="user"?"message-sent":"message-received",A=S.state==="partial"?"in-progress":"",k=h.makeHtml(S.text);return`<div class="message ${M} ${A}">
      ${k}
      <div class="tail">${qe}</div>
    </div>`},_=j.map(v).join(""),{chatContainer:g,chat:E}=F`
    <div name="chatContainer" class="chat-container">
      <div class="chat" name="chat">${_}</div>
    </div>
  `();d.querySelector(".chat")!==null?Ze(d.querySelector(".chat"),E):d.appendChild(g),r?d.scrollTo({top:d.scrollHeight,behavior:"smooth"}):d.scrollTop=f}const Ye=F`<div class="error-message" name="errorModal">
  <div class="error-header">
    <h3 class="error-title" name="titleEl"></h3>
  </div>
  <div class="error-content">
    <div class="error-text" name="messageEl"></div>
    <button class="action-button" name="closeButton">Close</button>
  </div>
</div> `;function ce(j,d,i){const{errorModal:r,closeButton:f,titleEl:h,messageEl:v}=Ye();return h.textContent=j,v.textContent=d,f==null||f.addEventListener("click",()=>{i()}),r}const et=F`<div class="survey-message" name="surveyModal">
  <div class="survey-header">
    <h3 class="survey-title" name="titleEl"></h3>
  </div>
  <div class="survey-content">
    <div class="survey-text" name="messageEl"></div>
    <div class="survey-actions">
      <button class="action-button outlined" name="closeButton">Close</button>
      <a
        class="survey-link action-button primary"
        name="surveyLink"
        target="_blank"
      >
        Take Survey ${`<?xml version="1.0" encoding="UTF-8"?>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M18 13V19C18 19.5304 17.7893 20.0391 17.4142 20.4142C17.0391 20.7893 16.5304 21 16 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V8C3 7.46957 3.21071 6.96086 3.58579 6.58579C3.96086 6.21071 4.46957 6 5 6H11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  <path d="M15 3H21V9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  <path d="M10 14L21 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg> `}
      </a>
    </div>
  </div>
</div>`;function tt(j,d){if(!j){d();return}const{surveyModal:i,closeButton:r,titleEl:f,messageEl:h,surveyLink:v}=et();return f.textContent=j.title??"Would you like to take a survey?",h.textContent=j.description??"We would love to hear your thoughts. Would you like to take a survey? It only takes 2 minutes.",v.href="#",r==null||r.addEventListener("click",()=>{d()}),v==null||v.addEventListener("click",_=>{_.preventDefault(),window.open(j.href,"_blank"),d()}),i}const rt=F`
  <div class="user-form-container" name="userFormContainer">
    <button type="button" class="close-button" name="closeButton">
      ${`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg> `}
    </button>

    <form class="user-form" name="userForm">
      <input type="text" name="userName" placeholder="Your Name" />
      <input
        type="email"
        name="userEmail"
        placeholder="Your Email (optional)"
      />
      <input
        type="tel"
        name="userPhone"
        placeholder="Your Phone Number (optional)"
      />
      <div class="form-buttons">
        <button type="button" name="skipButton" class="skip-button">
          Skip
        </button>
        <button type="submit" class="submit-button">Start Call</button>
      </div>
    </form>
  </div>
`;function at({onSubmit:j,onClose:d}){const{userFormContainer:i,userName:r,userEmail:f,userPhone:h,skipButton:v,closeButton:_}=rt(),g=S=>{i.classList.add("fade-out"),setTimeout(()=>{i.remove(),S()},300)};_.addEventListener("click",()=>{g(d)}),v.addEventListener("click",()=>{const S={userName:"",userEmail:"",userPhone:""};g(()=>j(S))});const E=i.querySelector("form");return E==null||E.addEventListener("submit",async S=>{S.preventDefault();const M={userName:r.value,userEmail:f.value,userPhone:h.value};g(()=>j(M))}),{userFormContainer:i,destroy:()=>g(()=>{})}}class Me extends HTMLElement{constructor(){super();C(this,"callOngoing",!1);C(this,"callLoading",!1);C(this,"callStarted",!1);C(this,"shadow",this.attachShadow({mode:"open"}));C(this,"callDetails",null);C(this,"call",null);C(this,"containerElement",null);C(this,"modalContainer",null);C(this,"previousOverflowStyle","");C(this,"token",null);C(this,"userVariables",null);this.setupDOM(),Y.apply(this.shadow)}static get observedAttributes(){return["token","buttonid","calldetails","uservariables"]}attributeChangedCallback(i,r,f){switch(i){case"token":this.token=f,this.call&&(this.call.token=f);break;case"calldetails":try{this.callDetails=JSON.parse(f)}catch{console.error("Invalid JSON in callDetails attribute"),this.callDetails=null}break;case"uservariables":try{const h=JSON.parse(f);this.userVariables=h,this.call&&this.call.addUserVariables(h)}catch{console.error("Invalid JSON in userVariables attribute"),this.userVariables=null}break}}connectedCallback(){const i=this.getAttribute("token");this.token=i;const r=this.getAttribute("buttonId");if(r){const f=v=>{v.classList.contains("demo-button-disabled")&&v.classList.remove("demo-button-disabled"),v.addEventListener("click",_=>{_.preventDefault(),_.stopPropagation(),this.setupCall()})},h=document.getElementById(r);h?f(h):new MutationObserver((_,g)=>{const E=document.getElementById(r);E&&(f(E),g.disconnect())}).observe(document.body,{childList:!0,subtree:!0})}try{const f=this.getAttribute("callDetails");if(f===null)throw new Error("callDetails attribute is required");this.callDetails=JSON.parse(f)}catch{console.error("Invalid JSON in callDetails attribute"),this.callDetails=null}try{const f=this.getAttribute("userVariables");f&&(this.userVariables=JSON.parse(f))}catch{console.error("Invalid JSON in userVariables attribute"),this.userVariables=null}this.call=new Be({callDetails:this.callDetails,token:this.token,widget:this}),this.userVariables&&this.call.addUserVariables(this.userVariables)}closeModal(i=!0){if(this.modalContainer){if(i&&this.callStarted){const r=this.getAttribute("survey");if(r)try{const f=JSON.parse(r),h=tt(f,()=>{this.finalizeClose()});if(h){this.modalContainer.appendChild(h);return}}catch{console.error("Invalid JSON in survey attribute")}}this.finalizeClose()}}finalizeClose(){if(this.modalContainer){const i=this.modalContainer.querySelector(".modal");this.modalContainer.classList.add("closing"),i==null||i.classList.add("closing"),setTimeout(()=>{var r,f;O.reset(),(r=this.modalContainer)==null||r.remove(),this.modalContainer=null,document.body.style.overflow=this.previousOverflowStyle,this.callOngoing=!1,this.callStarted=!1,(f=this.call)==null||f.reset()},800)}}async setupCall(){var A;if(this.callOngoing){console.warn("Call is already ongoing; nop");return}else if(this.callDetails===null||this.call===null){console.warn("No call or Call details provided");return}const i=new CustomEvent("beforecall",{cancelable:!0,bubbles:!0});if(!this.dispatchEvent(i)){console.log("Call cancelled by beforecall event handler");return}this.callOngoing=!0,this.callLoading=!0,this.previousOverflowStyle=document.body.style.overflow,document.body.style.overflow="hidden";const{modalContainer:f,videoPanel:h,videoArea:v,localVideoArea:_,controlsPanel:g,chatPanel:E}=re();this.modalContainer=f,(A=this.containerElement)==null||A.appendChild(f);const S=this.getAttribute("collectUserDetails")!=="false",M=async k=>{var R,H,T,e,a,t,n;k&&((R=this.call)==null||R.addUserVariables(k)),this.renderLoading(this.callLoading,h);const P=await O.getPermissions(((H=this.callDetails)==null?void 0:H.supportsVideo)??!1);if(!P.success){console.error("Error getting permissions");const s=ce("Error Accessing Devices",P.message||"Error getting device permissions. Please grant this page access and try again.",()=>this.closeModal());(T=this.modalContainer)==null||T.appendChild(s);return}let I=null;try{I=await((e=this.call)==null?void 0:e.dial(v,function(s){Ee(s,E)},function(s){_.appendChild(s)}))??null}catch(s){console.error("Error setting up call",s);const c=ce("Error","Error creating the call. Please refresh the page and try again.",()=>this.closeModal(!1));(a=this.modalContainer)==null||a.appendChild(c);return}I&&await O.setup(I),O.onAspectRatioChange=s=>{s&&_&&(_.style.aspectRatio=`${s}`)};const D=await ne(async()=>{var s;try{await((s=this.call)==null?void 0:s.hangup())}catch(c){console.error("Error hanging up call. Force terminating call.",c)}this.closeModal()});I==null||I.on("room.left",()=>{this.closeModal(!0)}),I==null||I.on("destroy",()=>{var c;const s=new CustomEvent("call.left",{detail:{call:(c=this.call)==null?void 0:c.currentCall},bubbles:!0});this.dispatchEvent(s),this.closeModal(!0)}),g.appendChild(D);try{await((t=this.call)==null?void 0:t.start()),this.callStarted=!0}catch(s){console.error("Error starting call",s);const c=ce("Error","Error starting the call. This is possibly due to network issues. Please refresh the page and try again.",()=>this.closeModal(!1));(n=this.modalContainer)==null||n.appendChild(c);return}this.callLoading=!1,this.renderLoading(this.callLoading,h)};if(S){const k=at({onSubmit:P=>{M(P)},onClose:()=>{this.closeModal(!1)}});v.appendChild(k.userFormContainer)}else await M()}renderLoading(i,r){var f;if(i){const{loading:h}=me();r.appendChild(h)}else(f=r.querySelector(".loading"))==null||f.remove()}setupDOM(){const i=document.createElement("div");this.shadow.appendChild(i),this.containerElement=i}disconnectedCallback(){this.closeModal(!1)}}customElements.define("c2c-widget",Me);class dt{constructor(){C(this,"entries",[]);C(this,"lastSpoken",null)}}class Pe{constructor(){C(this,"state");C(this,"aiPartialResult",null);C(this,"userPartialResult",null);this.state=new dt}getHistory(){const d=[...this.state.entries];return this.aiPartialResult&&this.userPartialResult?this.state.lastSpoken==="user"?(d.push(this.aiPartialResult),d.push(this.userPartialResult)):(d.push(this.userPartialResult),d.push(this.aiPartialResult)):this.aiPartialResult?d.push(this.aiPartialResult):this.userPartialResult&&d.push(this.userPartialResult),d}handleEvent(d,i,r){switch(d){case"ai.response_utterance":this.aiPartialResult?this.aiPartialResult.text+=" "+i:this.aiPartialResult={type:"ai",text:i,state:"partial"},this.state.lastSpoken="ai";break;case"ai.completion":this.aiPartialResult&&(this.state.entries.push({...this.aiPartialResult,state:"complete"}),this.aiPartialResult=null),this.state.lastSpoken=r?"user":"ai";break;case"ai.partial_result":this.userPartialResult={type:"user",text:i,state:"partial"},this.state.lastSpoken="user";break;case"ai.speech_detect":this.userPartialResult?(this.state.entries.push({...this.userPartialResult,state:"complete",text:i}),this.userPartialResult=null):this.state.entries.push({type:"user",text:i,state:"complete"}),this.state.lastSpoken="user";break;case"ai.transparent_barge":this.aiPartialResult=null,this.state.entries.push({type:"user",text:i,state:"complete"}),this.state.lastSpoken="user";break}this.onUpdate()}onUpdate(){}}class nt{constructor({config:d,widget:i}){C(this,"client",null);C(this,"clientInitPromise",null);C(this,"config",null);C(this,"widget");C(this,"chat",null);C(this,"currentCall",null);if(this.widget=i,d)this.config=d,this.clientInitPromise=this.setupClient(d);else throw new Error("Config is not set");const r=()=>{this.currentCall&&this.currentCall.hangup()};window.addEventListener("beforeunload",r),window.addEventListener("unload",r)}async getWidgetToken(d){const i=await fetch("https://embeds.signalwire.com/api/fabric/embeds/tokens",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:d})});if(!i.ok)throw new Error("Failed to authenticate embeds token");return(await i.json()).token}getLocalVideoTrack(){var d;return(d=this.currentCall)==null?void 0:d.localVideoTrack}getLocalAudioTrack(){var d;return(d=this.currentCall)==null?void 0:d.localAudioTrack}async setupClient(d){const i=d.getToken();if(!i)throw new Error("Token is not set");let r=i;i.startsWith("c2c_")&&(r=await this.getWidgetToken(i));const f=d.getDebugMode(),h=d.getDebugWsTraffic();["ci-SAT","pt-SAT","as-SAT"].forEach(_=>sessionStorage.removeItem(_));const v=await U.SignalWire({token:r,host:d.getHost()??void 0,logLevel:f??void 0,debug:h?{logWsTraffic:h}:void 0});return v.on("ai.partial_result",_=>{var g;(g=this.chat)==null||g.handleEvent("ai.partial_result",_.text??"",_.barged??!1)}),v.on("ai.speech_detect",_=>{var E;const g=_.text.replace(/\{confidence=[\d.]+\}/,"");(E=this.chat)==null||E.handleEvent("ai.speech_detect",g,_.type!=="normal")}),v.on("ai.transparent_barge",_=>{var E;console.log("ai.transparent_barge",_);const g=_.combined_text;(E=this.chat)==null||E.handleEvent("ai.transparent_barge",g,!0)}),v.on("ai.completion",_=>{var g;(g=this.chat)==null||g.handleEvent("ai.completion",_.text??"",_.type==="barged")}),v.on("ai.response_utterance",_=>{var g;(g=this.chat)==null||g.handleEvent("ai.response_utterance",_.utterance??"",!1)}),v.on("calling.user_event",_=>{console.log("calling.user_event",_);const g=new CustomEvent("calling.user_event",{detail:_,bubbles:!0});this.widget.dispatchEvent(g)}),d.getReceiveCalls()&&v.online({incomingCallHandlers:{websocket:_=>{var E,S;console.log("incoming call",_);const g=new CustomEvent("call.incoming",{detail:{callInvite:_,caller:{name:(E=_.invite.details)==null?void 0:E.caller_id_name,number:(S=_.invite.details)==null?void 0:S.caller_id_number},accept:async M=>{const A=await _.invite.accept(M);return this.currentCall=A,A},reject:()=>_.invite.reject()},bubbles:!0});this.widget.dispatchEvent(g)}}}),this.client=v,v}async dial(d,i,r){var M,A,k;if(!this.client&&this.clientInitPromise&&await this.clientInitPromise,!await new Promise(P=>{const I=new CustomEvent("beforeDial",{detail:{hasListeners:!1,approve:()=>P(!0),reject:()=>P(!1)},bubbles:!0});this.widget.dispatchEvent(I),I.detail.hasListeners||P(!0)}))return await this.destroy(),null;if(console.log(this.client),!this.client)throw new Error("Client is not initialized");this.chat=new Pe,this.chat.onUpdate=()=>{var P;i(((P=this.chat)==null?void 0:P.getHistory())??[])},this.chat.onUpdate();const h=this.widget.getUserVariables(),v=(M=this.config)==null?void 0:M.getDestination(),_=(A=this.config)==null?void 0:A.getSupportAudio(),g=(k=this.config)==null?void 0:k.getSupportVideo();if(!v)throw new Error("Destination is not set");const E={callOriginHref:window.location.href,...h},S=await this.client.dial({to:v,rootElement:d??void 0,audio:_??void 0,video:g??void 0,negotiateVideo:g??void 0,userVariables:E});return this.currentCall=S,console.info("Call started",this.currentCall,"with user variables",E),S.on("call.joined",()=>{const P=new CustomEvent("call.joined",{detail:{call:this.currentCall,client:this.client},bubbles:!0});if(this.widget.dispatchEvent(P),window.call=S,S!=null&&S.localStream){O.updateVideoAspectRatio();const{localVideo:I}=F`<video
          autoplay
          playsinline
          muted
          name="localVideo"
        ></video>`();I.onloadedmetadata=()=>{O.onAspectRatioChange(I.videoWidth/I.videoHeight)},I.srcObject=S.localStream,r(I)}}),S.on("call.left",()=>{const P=new CustomEvent("call.left",{detail:{call:this.currentCall},bubbles:!0});this.widget.dispatchEvent(P)}),S.on("destroy",()=>{const P=new CustomEvent("destroy",{detail:{call:this.currentCall},bubbles:!0});this.widget.dispatchEvent(P)}),S}async start(){var d;if(!this.client)throw new Error("Client is not set");await((d=this.currentCall)==null?void 0:d.start())}async hangup(){var d;if(!this.currentCall)throw new Error("Call is not set");await((d=this.currentCall)==null?void 0:d.hangup())}async destroy(){this.currentCall&&await this.currentCall.hangup(),this.client&&(this.client.off("ai.partial_result"),this.client.off("ai.speech_detect"),this.client.off("ai.completion"),this.client.off("ai.response_utterance"),this.client.disconnect(),this.client=null),this.currentCall=null,this.chat=null}reset(){var d;this.client&&(this.client.off("ai.partial_result"),this.client.off("ai.speech_detect"),this.client.off("ai.completion"),this.client.off("ai.response_utterance")),(d=this.currentCall)==null||d.hangup(),this.currentCall=null,this.chat=new Pe}}class ut{constructor(d,i){C(this,"observer",null);C(this,"buttonId");C(this,"onClick");C(this,"button",null);C(this,"handleClick",d=>{d.preventDefault(),d.stopPropagation(),this.onClick()});this.buttonId=d,this.onClick=i,this.setupButton()}setupButton(){const d=document.getElementById(this.buttonId);d?(this.button=d,this.attachClickHandler(d)):this.startObserving()}attachClickHandler(d){d.classList.contains("demo-button-disabled")&&d.classList.remove("demo-button-disabled"),d.addEventListener("click",this.handleClick)}startObserving(){this.observer=new MutationObserver((d,i)=>{const r=document.getElementById(this.buttonId);r&&(this.button=r,this.attachClickHandler(r),i.disconnect(),this.observer=null)}),this.observer.observe(document.body,{childList:!0,subtree:!0})}disconnectObserver(){this.observer&&(this.observer.disconnect(),this.observer=null)}destroy(){this.button&&(this.button.removeEventListener("click",this.handleClick),this.button=null),this.disconnectObserver()}}const $=class ${constructor(d){C(this,"widget");this.widget=d}getAttribute(d){const i=this.widget.getAttribute(d.name);if(i===null){if(d.required)throw new Error(`Required attribute "${d.name}" is missing`);return null}try{return d.parser(i)}catch(r){throw r instanceof Error?new Error(`Failed to parse attribute "${d.name}": ${r.message}`):r}}getReceiveCalls(){return this.getAttribute($.attributeDefinitions.receiveCalls)}getAutoAnswer(){return this.getAttribute($.attributeDefinitions.autoAnswer)}getWindowMode(){return this.getAttribute($.attributeDefinitions.windowMode)}getHost(){return this.getAttribute($.attributeDefinitions.host)}getDebugMode(){return this.getAttribute($.attributeDefinitions.logLevel)}getDebugWsTraffic(){return this.getAttribute($.attributeDefinitions.debugWsTraffic)}getAudioCodec(){return this.getAttribute($.attributeDefinitions.audioCodec)}getDestination(){return this.getAttribute($.attributeDefinitions.destination)}getSupportAudio(){return this.getAttribute($.attributeDefinitions.supportAudio)}getSupportVideo(){return this.getAttribute($.attributeDefinitions.supportVideo)}getToken(){return this.getAttribute($.attributeDefinitions.token)}getBackgroundImage(){return this.getAttribute($.attributeDefinitions.backgroundImage)??$.DEFAULT_BACKGROUND_IMAGE}getBackgroundThumbnail(){return this.getAttribute($.attributeDefinitions.backgroundThumbnail)??$.DEFAULT_BACKGROUND_THUMBNAIL}};C($,"DEFAULT_BACKGROUND_IMAGE","https://developer.signalwire.com/img/call-widget/sw_background.webp"),C($,"DEFAULT_BACKGROUND_THUMBNAIL","data:image/webp;base64,UklGRv4BAABXRUJQVlA4IPIBAAAQDgCdASpkADgAPm0wlEgkIqIlpvVbQLANiWUIcAF/N0SNSoFwLlO5RP2YPzaIbnj2FRb+bYMVMO2hQaOhoOYVcYas+y/tUm1/zmSSq5AUjQJ+cqL2Z4Z7qXLgXDAOWYT82r5bm+2mFDM38Q0ruBiEoVE+LSAJdoHQAP7gQtoYHET/VcymFbJngGPQnLANH4pBKeNTCNh83JD/q72P9SVEf91Mx4GHZGI07V8EIhDuJRWajJcwkrY9epV7HluQk5qhMElwzHER6a3Zc/OaBy35/gKiNW/4Wd0oEovwE2r9jyX1HImaWtlcTNyPPjyqvi7m5rKNN82p/S01kcM9spuizE4Pba01gNXE5vPW68xKBA/5rLkd/4UosKilKe9PXgPgEgNiTV8tlHZ33yDJQSojodoGsBvOsVgYm06hOx2FqbPFSVY/2mjEsBcCuGQAy1+sBIt2FygUENMwQ4jSOFHEQZ7C9Sc/t1gIlR2bZtNtp1BWIQW/Iu6DDMwjSSTX4qjCwnN6/sqzlv0ZFBAKVIX4uy9DbwSWFKGKqDlsrbAmVFaioKHX3IX/Xm49jyIK7/0PIre8rpPO7DBAX5JbGQCYg8mbG2uf5xTT1gAWy0N4hyjd8bt6FFnL6eUOrt6Hjzy5gP+/8lb0glwD14Mjd9AAAAA="),C($,"attributeDefinitions",{audioCodec:{name:"audio-codec",parser:d=>{const i=d.split(",").map(r=>r.trim());if(i.some(r=>!r))throw new Error("Codecs cannot be empty strings");return i},required:!1},destination:{name:"destination",parser:d=>{if(!d.trim())throw new Error("Destination cannot be empty");return d},required:!0},supportAudio:{name:"support-audio",parser:d=>{const i=d.toLowerCase();if(i!=="true"&&i!=="false")throw new Error('Must be "true" or "false"');return i==="true"},required:!1},supportVideo:{name:"support-video",parser:d=>{const i=d.toLowerCase();if(i!=="true"&&i!=="false")throw new Error('Must be "true" or "false"');return i==="true"},required:!1},token:{name:"token",parser:d=>{if(!d.trim())throw new Error("Token cannot be empty");return d},required:!0},logLevel:{name:"log-level",parser:d=>{const i=["debug","info","warn","error"];if(!i.includes(d.toLowerCase()))throw new Error(`Invalid log level. Must be one of: ${i.join(", ")}`);return d},required:!1},debugWsTraffic:{name:"debug-ws-traffic",parser:d=>{const i=d.toLowerCase();if(i!=="true"&&i!=="false")throw new Error('Must be "true" or "false"');return i==="true"},required:!1},host:{name:"host",parser:d=>{if(!d.trim())throw new Error("Host cannot be empty");try{new URL(`https://${d}`)}catch{throw new Error("Invalid host format")}return d},required:!1},windowMode:{name:"window-mode",parser:d=>{const i=["video+transcript","video","audio+transcript"],r=d.trim();if(!i.includes(r))throw new Error(`Invalid window mode. Must be one of: ${i.join(", ")}`);return r},required:!1},backgroundImage:{name:"background-image",parser:d=>{if(!d.trim())throw new Error("Background image URL cannot be empty");try{new URL(d)}catch{throw new Error("Invalid background image URL format")}return d},required:!1},backgroundThumbnail:{name:"background-thumbnail",parser:d=>{if(!d.trim())throw new Error("Background thumbnail cannot be empty");return d},required:!1},receiveCalls:{name:"receive-calls",parser:d=>{const i=d.toLowerCase();if(i!=="true"&&i!=="false")throw new Error('Must be "true" or "false"');return i==="true"},required:!1},autoAnswer:{name:"auto-answer",parser:d=>{const i=d.toLowerCase();if(i!=="true"&&i!=="false")throw new Error('Must be "true" or "false"');return i==="true"},required:!1}});let le=$;class Se{constructor(d){C(this,"element");C(this,"isLoading",!1);this.element=d}setLoading(d){this.isLoading!==d&&(this.isLoading=d,this.render())}render(){const d=this.element.querySelector(".loading");if(this.isLoading){if(!d){const{loading:i}=me();this.element.appendChild(i)}}else d==null||d.remove()}}class Ae extends HTMLElement{constructor(){super();C(this,"shadow",this.attachShadow({mode:"open"}));C(this,"resolvePromise",null);Y.apply(this.shadow)}show(i,r){const f=document.createElement("div");f.className="info-modal",f.innerHTML=`
      <div class="info-modal-content">
        <h2>${i}</h2>
        <p>${r}</p>
        <button class="ok-button">OK</button>
      </div>
    `;const h=document.createElement("style");return h.textContent=`
      .info-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
      }

      .info-modal-content {
        background: white;
        padding: 20px;
        border-radius: 8px;
        max-width: 400px;
        text-align: center;
      }

      .ok-button {
        padding: 8px 16px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 16px;
      }

      .ok-button:hover {
        background: #0056b3;
      }
    `,this.shadow.appendChild(h),this.shadow.appendChild(f),new Promise(v=>{this.resolvePromise=v;const _=f.querySelector(".ok-button");_==null||_.addEventListener("click",()=>this.handleOk())})}handleOk(){this.resolvePromise&&(this.resolvePromise(!0),this.resolvePromise=null),this.shadow.innerHTML=""}}customElements.define("call-info-modal",Ae);class Le extends HTMLElement{constructor(){super();C(this,"shadow",this.attachShadow({mode:"open"}))}async show(i,r){const f=document.createElement("div");f.classList.add("overlay");const h=document.createElement("div");h.classList.add("incoming-call-modal");const v=document.createElement("div");v.classList.add("content");const _=document.createElement("h2");_.textContent="Incoming Call";const g=document.createElement("div");g.classList.add("caller-info"),g.innerHTML=`
      <p class="caller-name">${i||"Unknown"}</p>
      <p class="caller-number">${r||"Unknown"}</p>
    `;const E=document.createElement("div");E.classList.add("button-container");const S=document.createElement("button");S.classList.add("accept"),S.innerHTML='<svg viewBox="0 0 24 24" height="24px" width="24px"><path fill="currentColor" d="M6.62 10.79c1.44 2.83 3.76 5.15 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.24.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>';const M=document.createElement("button");M.classList.add("decline"),M.innerHTML=be,E.appendChild(S),E.appendChild(M),v.appendChild(_),v.appendChild(g),v.appendChild(E),h.appendChild(v);const A=document.createElement("style");return A.textContent=`
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        z-index: 999;
      }

      .incoming-call-modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        min-width: 300px;
      }

      .content {
        text-align: center;
      }

      h2 {
        margin: 0 0 16px;
        color: #333;
      }

      .caller-info {
        margin-bottom: 24px;
      }

      .caller-name {
        font-size: 18px;
        margin: 0 0 8px;
        font-weight: 500;
      }

      .caller-number {
        font-size: 14px;
        margin: 0;
        color: #666;
      }

      .button-container {
        display: flex;
        justify-content: center;
        gap: 24px;
      }

      button {
        width: 56px;
        height: 56px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s;
      }

      button:hover {
        transform: scale(1.1);
      }

      button svg {
        width: 24px;
        height: 24px;
      }

      .accept {
        background: #4CAF50;
        color: white;
      }

      .decline {
        background: #f44336;
        color: white;
      }
    `,this.shadow.appendChild(A),this.shadow.appendChild(f),this.shadow.appendChild(h),new Promise(k=>{S.addEventListener("click",()=>k("accept")),M.addEventListener("click",()=>k("decline"))})}}customElements.define("incoming-call-modal",Le);class je extends HTMLElement{constructor(){super();C(this,"callOngoing",!1);C(this,"shadow",this.attachShadow({mode:"open"}));C(this,"callManager",null);C(this,"containerElement",null);C(this,"modalContainer",null);C(this,"previousOverflowStyle","");C(this,"token",null);C(this,"userVariables",{});C(this,"buttonObserver",null);C(this,"config");C(this,"loadingManager",null);C(this,"activeInfoModal",null);const i=document.createElement("div");this.shadow.appendChild(i),this.containerElement=i,Y.apply(this.shadow),this.config=new le(this)}static get observedAttributes(){return["token","button-id"]}setUserVariables(i){for(const[r,f]of Object.entries(i))if(typeof f!="string")throw new Error(`User variable '${r}' must be a string, got ${typeof f}`);this.userVariables={...i}}addUserVariables(i){for(const[r,f]of Object.entries(i))if(typeof f!="string")throw new Error(`User variable '${r}' must be a string, got ${typeof f}`);this.userVariables={...this.userVariables,...i}}getUserVariables(){return{...this.userVariables}}attributeChangedCallback(i,r,f){var h;i==="button-id"&&((h=this.buttonObserver)==null||h.destroy(),this.buttonObserver=new ut(f,()=>this.setupCall())),i==="token"&&(async()=>{var v;await((v=this.callManager)==null?void 0:v.destroy()),this.callManager=new nt({config:this.config,widget:this})})()}connectedCallback(){this.addEventListener("call.incoming",async i=>{await this.setupCallFromNotification(i.detail)})}closeModal(){if(this.modalContainer){const i=this.modalContainer.querySelector(".modal");this.modalContainer.classList.add("closing"),i==null||i.classList.add("closing"),setTimeout(()=>{var r,f;O.reset(),(r=this.modalContainer)==null||r.remove(),this.modalContainer=null,document.body.style.overflow=this.previousOverflowStyle,this.callOngoing=!1,(f=this.callManager)==null||f.reset(),this.dispatchEvent(new CustomEvent("call.ended",{bubbles:!0,detail:{}}))},800)}}async showError(i,r){var h;const f=new Ae;this.activeInfoModal=f,(h=this.modalContainer)==null||h.appendChild(f),await f.show(i,r),this.activeInfoModal=null,f.remove()}async setupCall(){var D,R,H,T,e,a;if(this.callOngoing){console.warn("Call is already ongoing; nop");return}else if(this.callManager===null){console.warn("CallManager Object is not initialized");return}const i=new CustomEvent("beforecall",{cancelable:!0,bubbles:!0});if(!this.dispatchEvent(i)){console.log("Call cancelled by beforecall event handler");return}this.callOngoing=!0,(D=this.loadingManager)==null||D.setLoading(!0),this.previousOverflowStyle=document.body.style.overflow,document.body.style.overflow="hidden";const f=this.config.getWindowMode();console.log("windowMode",f);let{modalContainer:h,videoPanel:v,videoArea:_,localVideoArea:g,controlsPanel:E,chatPanel:S}=re({backgroundImage:this.config.getBackgroundImage(),backgroundThumbnail:this.config.getBackgroundThumbnail()});const M=h.querySelector(".modal");f==="video"?(M==null||M.classList.add("video-mode"),S.style.display="none"):f==="video+transcript"||f===null||f==="audio+transcript"&&(M==null||M.classList.add("audio-transcript-mode")),this.modalContainer=h,(R=this.containerElement)==null||R.appendChild(h),this.loadingManager=new Se(v),(H=this.loadingManager)==null||H.setLoading(!0);const A=this.config.getSupportVideo(),k=await O.getPermissions(A??!1);if(!k.success){console.error("Error getting permissions"),await this.showError("Error Accessing Devices",k.message||"Error getting device permissions. Please grant this page access and try again."),this.closeModal();return}let P=null;try{P=await((T=this.callManager)==null?void 0:T.dial(_??void 0,function(t){S&&Ee(t,S)},function(t){g&&g.appendChild(t)}))??null}catch(t){console.error("Error setting up call",t),await this.showError("Error","Error creating the call. Please refresh the page and try again."),this.closeModal(),this.dispatchEvent(new CustomEvent("call.failed",{bubbles:!0,detail:{error:t}}));return}if(!P){this.closeModal();return}P&&await O.setup(P),O.onAspectRatioChange=t=>{t&&g&&(g.style.aspectRatio=`${t}`)};const I=await ne(async()=>{var t;try{await((t=this.callManager)==null?void 0:t.hangup())}catch(n){console.error("Error hanging up call. Force terminating call.",n)}this.closeModal()},{supportsVideo:this.config.getSupportVideo()??!1,supportsAudio:this.config.getSupportAudio()??!1});P==null||P.on("destroy",async()=>{if(this.activeInfoModal){const t=new MutationObserver(()=>{this.activeInfoModal||(t.disconnect(),this.closeModal())});t.observe(this.modalContainer,{childList:!0,subtree:!0})}else this.closeModal()}),E&&E.appendChild(I);try{await((e=this.callManager)==null?void 0:e.start()),this.callOngoing=!0}catch(t){console.error("Error starting call",t),await this.showError("Error","Error starting the call. This is possibly due to network issues. Please refresh the page and try again."),this.closeModal(),this.dispatchEvent(new CustomEvent("call.failed",{bubbles:!0,detail:{error:t}}));return}(a=this.loadingManager)==null||a.setLoading(!1)}async setupCallFromNotification(i){var k,P,I,D,R,H;if(this.callOngoing){try{await((k=this.callManager)==null?void 0:k.destroy())}catch(T){console.error("Error destroying call",T)}return}let r=null;if(this.config.getAutoAnswer())r="accept";else{const T=new Le;(P=this.containerElement)==null||P.appendChild(T),r=await T.show(i.caller.name,i.caller.number),T.remove()}this.callOngoing=!0,(I=this.loadingManager)==null||I.setLoading(!0),this.previousOverflowStyle=document.body.style.overflow,document.body.style.overflow="hidden";let{modalContainer:f,videoPanel:h,videoArea:v,localVideoArea:_,controlsPanel:g}=re({backgroundImage:this.config.getBackgroundImage(),backgroundThumbnail:this.config.getBackgroundThumbnail()});this.modalContainer=f,(D=this.containerElement)==null||D.appendChild(f),this.loadingManager=new Se(h),(R=this.loadingManager)==null||R.setLoading(!0);const E=this.config.getSupportVideo(),S=await O.getPermissions(E??!1);if(!S.success){console.error("Error getting permissions"),await this.showError("Error Accessing Devices",S.message||"Error getting device permissions. Please grant this page access and try again."),this.closeModal();return}let M=null;r==="accept"?M=await i.accept({rootElement:v}):await i.reject(),M==null||M.on("call.joined",()=>{console.log("Call joined from Notification")}),M==null||M.on("room.joined",()=>{console.log("Room joined from Notification")}),M==null||M.on("room.joined",()=>{console.log("Call Joined from Notification");const T=new CustomEvent("call.joined",{detail:{call:M,fromNotification:!0},bubbles:!0});if(this.dispatchEvent(T),window.call=M,M!=null&&M.localStream){O.updateVideoAspectRatio();const{localVideo:e}=F`<video
          autoplay
          playsinline
          muted
          name="localVideo"
        ></video>`();e.onloadedmetadata=()=>{O.onAspectRatioChange(e.videoWidth/e.videoHeight)},e.srcObject=M.localStream,_.appendChild(e)}}),M&&await O.setup(M),O.onAspectRatioChange=T=>{T&&_&&(_.style.aspectRatio=`${T}`)};const A=await ne(async()=>{try{await(M==null?void 0:M.hangup())}catch(T){console.error("Error hanging up call. Force terminating call.",T)}this.closeModal()},{supportsVideo:this.config.getSupportVideo()??!1,supportsAudio:this.config.getSupportAudio()??!1});M==null||M.on("destroy",async()=>{if(this.activeInfoModal){const T=new MutationObserver(()=>{this.activeInfoModal||(T.disconnect(),this.closeModal())});T.observe(this.modalContainer,{childList:!0,subtree:!0})}else this.closeModal()}),g.appendChild(A),(H=this.loadingManager)==null||H.setLoading(!1)}disconnectedCallback(){var i;(i=this.buttonObserver)==null||i.disconnectObserver(),this.closeModal()}}customElements.define("call-widget",je);class it{constructor(d){C(this,"element");C(this,"shadow");C(this,"callbacks");C(this,"widget");this.callbacks=d.callbacks,this.widget=d.widget,this.element=document.createElement("div"),this.shadow=this.element.attachShadow({mode:"closed"}),this.render(),this.attachEventListeners()}render(){this.shadow.innerHTML=`
      <style>
        :host {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.5);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 10000;
        }

        .modal-content {
          background: white;
          border-radius: 8px;
          padding: 24px;
          width: 90%;
          max-width: 400px;
          position: relative;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
        }

        .modal-title {
          font-size: 18px;
          font-weight: 600;
          margin: 0;
        }

        .close-button {
          background: none;
          border: none;
          font-size: 24px;
          cursor: pointer;
          color: #666;
          padding: 0;
          width: 30px;
          height: 30px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .close-button:hover {
          color: #333;
        }

        .form-group {
          margin-bottom: 16px;
        }

        .form-label {
          display: block;
          margin-bottom: 6px;
          font-weight: 500;
          color: #333;
        }

        .form-input {
          width: 100%;
          padding: 10px;
          border: 1px solid #ddd;
          border-radius: 4px;
          font-size: 14px;
          box-sizing: border-box;
        }

        .form-input:focus {
          outline: none;
          border-color: #007bff;
        }

        .continue-button {
          width: 100%;
          padding: 12px;
          background-color: #007bff;
          color: white;
          border: none;
          border-radius: 4px;
          font-size: 16px;
          cursor: pointer;
          margin-top: 10px;
        }

        .continue-button:hover {
          background-color: #0056b3;
        }

        .continue-button:disabled {
          background-color: #ccc;
          cursor: not-allowed;
        }

        @media (max-width: 480px) {
          .modal-content {
            width: 95%;
            padding: 20px;
          }
        }
      </style>
      
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Contact Information</h2>
          <button class="close-button" id="closeModal">&times;</button>
        </div>
        <form id="contactForm">
          <div class="form-group">
            <label class="form-label" for="name">Name</label>
            <input 
              type="text" 
              id="name" 
              name="name" 
              class="form-input" 
              required 
              placeholder="Enter your name"
            />
          </div>
          <div class="form-group">
            <label class="form-label" for="email">Email</label>
            <input 
              type="email" 
              id="email" 
              name="email" 
              class="form-input" 
              required 
              placeholder="Enter your email"
            />
          </div>
          <div class="form-group">
            <label class="form-label" for="number">Phone Number</label>
            <input 
              type="tel" 
              id="number" 
              name="number" 
              class="form-input" 
              required 
              placeholder="Enter your phone number"
            />
          </div>
          <button type="submit" class="continue-button">Continue</button>
        </form>
      </div>
    `}attachEventListeners(){const d=this.shadow.getElementById("closeModal"),i=this.shadow.getElementById("contactForm"),r=this.shadow.querySelector(".modal-content");d==null||d.addEventListener("click",()=>{this.handleCancel()}),this.element.addEventListener("click",f=>{f.target===this.element&&this.handleCancel()}),r==null||r.addEventListener("click",f=>{f.stopPropagation()}),i==null||i.addEventListener("submit",f=>{f.preventDefault(),this.handleSubmit(i)})}handleCancel(){this.callbacks.onCancel(),this.element.remove()}handleSubmit(d){const i=new FormData(d),r={name:i.get("name"),email:i.get("email"),number:i.get("number")};if(this.widget){const f={userName:r.name,userEmail:r.email,userPhone:r.number};this.widget.setAttribute("user-variables",JSON.stringify(f))}this.callbacks.onSubmit(r),this.element.remove()}}function st(j,d){const i=new it({callbacks:j,widget:d});document.body.appendChild(i.element)}N.C2CWidget=Me,N.CallWidget=je,N.showContactForm=st,Object.defineProperty(N,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=c2c-widget.umd.js.map
